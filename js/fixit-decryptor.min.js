(()=>{FixItDecryptor=function(p={}){var i=FixItDecryptor.prototype;this.options=p||{},this.options.duration=this.options.duration||24*60*60,this.decryptedEventSet=new Set,this.resetEventSet=new Set,this.$el=document.querySelector(".fixit-decryptor-container");var l=e=>{try{this.$el.querySelector(".fixit-decryptor-loading").classList.add("d-none"),this.$el.querySelector("#fixit-decryptor-input").classList.add("d-none"),this.$el.querySelector(".fixit-encryptor-btn").classList.remove("d-none"),document.querySelector("#content").insertAdjacentHTML("afterbegin",CryptoJS.enc.Base64.parse(e).toString(CryptoJS.enc.Utf8))}catch(t){return console.error(t)}console.log(this.decryptedEventSet);for(let t of this.decryptedEventSet)t()};i.init=()=>{this.addEventListener("decrypted",this.options?.decrypted),this.addEventListener("reset",this.options?.reset),this.validateCache();let e=this;this.$el.querySelector("#fixit-decryptor-input")?.addEventListener("keydown",function(t){if(t.key==="Enter"){t.preventDefault();let n=document.querySelector("#content"),c=n.getAttribute("data-password"),r=this.value.trim(),s=r.length%2?r.length:r.length+1,a=CryptoJS.MD5(r).toString(),o=CryptoJS.SHA256(r).toString();if(this.value="",this.blur(),!r)return alert("Please enter the correct password!"),console.warn("Please enter the correct password!");if(a!==c)return alert(`Password error: ${r} not the correct password!`),console.warn(`Password error: ${r} not the correct password!`);window.localStorage?.setItem(`fixit-decryptor/#${location.pathname}`,JSON.stringify({expiration:Math.ceil(Date.now()/1e3)+e.options.duration,md5:a,sha256:o.slice(s)})),l(n.getAttribute("data-content").replace(o.slice(s),""))}}),this.$el.querySelector(".fixit-encryptor-btn")?.addEventListener("click",function(t){t.preventDefault(),this.classList.add("d-none"),e.$el.querySelector("#fixit-decryptor-input").classList.remove("d-none"),document.querySelector("#content").innerHTML="",document.querySelector("#content").insertAdjacentElement("afterbegin",e.$el),window.localStorage?.removeItem(`fixit-decryptor/#${location.pathname}`);for(let n of e.resetEventSet)n()})},i.initShortcodes=()=>{let e=this;document.querySelectorAll("fixit-encryptor:not(.decrypted)").forEach(n=>{n.querySelector(".fixit-decryptor-input")?.addEventListener("keydown",function(c){if(c.key==="Enter"){c.preventDefault();let r=this.parentElement.parentElement,s=r.nextElementSibling,a=s.getAttribute("data-password"),o=this.value.trim(),u=o.length%2?o.length:o.length+1,h=CryptoJS.MD5(o).toString(),y=CryptoJS.SHA256(o).toString();if(this.value="",this.blur(),!o)return alert("Please enter the correct password!"),console.warn("Please enter the correct password!");if(h!==a)return alert(`Password error: ${o} not the correct password!`),console.warn(`Password error: ${o} not the correct password!`);try{let d=s.getAttribute("data-content").replace(y.slice(u),"");r.querySelector(".fixit-decryptor-input").classList.add("d-none"),s.insertAdjacentHTML("afterbegin",CryptoJS.enc.Base64.parse(d).toString(CryptoJS.enc.Utf8)),r.parentElement.classList.add("decrypted")}catch(d){return console.error(d)}}})})},i.validateCache=()=>{let e=document.querySelector("#content"),t=e.getAttribute("data-password"),n=JSON.parse(window.localStorage?.getItem(`fixit-decryptor/#${location.pathname}`));return n?n?.md5!==t||Number(n?.expiration)<Math.ceil(Date.now()/1e3)?(this.$el.querySelector(".fixit-decryptor-loading").classList.add("d-none"),this.$el.querySelector("#fixit-decryptor-input").classList.remove("d-none"),window.localStorage?.removeItem(`fixit-decryptor/#${location.pathname}`),console.warn("The password has expired, please re-enter!"),this):(l(e.getAttribute("data-content").replace(n.sha256,"")),this):(this.$el.querySelector(".fixit-decryptor-loading").classList.add("d-none"),this.$el.querySelector("#fixit-decryptor-input").classList.remove("d-none"),this)},i.addEventListener=(e,t)=>{if(typeof t!="function")return this;switch(e){case"decrypted":this.decryptedEventSet.add(t);break;case"reset":this.resetEventSet.add(t);break;default:console.warn(`Event ${e} not found in FixIt Decryptor!`);break}return this},i.removeEventListener=(e,t)=>{if(typeof t!="function")return this;switch(e){case"decrypted":this.decryptedEventSet.delete(t);break;case"reset":this.resetEventSet.delete(t);break;default:console.warn(`Event ${e} not found in FixIt Decryptor!`);break}return this}};})();
