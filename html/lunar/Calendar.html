<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏áËÉΩÊó•ÂéÜ</title>
    <script src="lunar.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            display: flex;
            gap: 30px;
            padding: 30px;
            max-width: 1400px;
            width: 100%;
        }

        .calendar-section {
            flex: 2;
        }

        .detail-section {
            flex: 1;
            min-width: 350px;
            max-width: 400px;
            display: flex;
            flex-direction: column;
        }





        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            border-radius: 15px;
            color: white;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .festival-selector {
            position: relative;
            display: inline-block;
        }

        .festival-toggle {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            border: 1px solid #9C27B0;
        }

        .festival-toggle:hover {
            background: linear-gradient(135deg, #7B1FA2, #9C27B0);
        }

        .theme-selector {
            position: relative;
            display: inline-block;
        }

        .theme-toggle {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            border: 1px solid #2196F3;
        }

        .theme-toggle:hover {
            background: linear-gradient(135deg, #1976D2, #2196F3);
        }

        .theme-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            padding: 8px;
            min-width: 140px;
            z-index: 1000;
            display: none;
            margin-top: 5px;
        }

        .theme-dropdown.show {
            display: block;
        }

        .theme-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 6px;
            font-size: 13px;
            gap: 8px;
            color: #333;
            font-weight: 500;
        }

        .theme-option:hover {
            background-color: #f0f0f0;
            color: #1976D2;
        }

        .theme-option.active {
            background-color: #1976D2;
            color: white;
            font-weight: bold;
        }

        .theme-icon {
            font-size: 16px;
            min-width: 20px;
        }

        .festival-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            padding: 12px;
            min-width: 140px;
            z-index: 1000;
            display: none;
            margin-top: 5px;
        }

        .festival-dropdown.show {
            display: block;
        }

        .festival-option {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 4px;
            font-size: 13px;
            color: #333;
        }

        .festival-option:hover {
            background-color: #f0f0f0;
        }

        .festival-option input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.1);
        }

        .festival-option span {
            color: #333;
            user-select: none;
        }

        .today-btn {
            background: linear-gradient(135deg, #FF6B6B, #E6A23C);
            border: 1px solid #FF6B6B;
        }

        .today-btn:hover {
            background: linear-gradient(135deg, #E6A23C, #FF6B6B);
            transform: translateY(-2px);
        }

        .date-selector {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .year-input, .month-select {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.5);
            color: #333;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
        }

        .year-input {
            min-width: 100px;
            text-align: center;
            font-size: 16px;
        }

        .month-select {
            font-size: 14px;
        }

        .year-input::-webkit-inner-spin-button, .year-input::-webkit-outer-spin-button {
            opacity: 1;
        }

        .year-input:focus, .month-select:focus {
            background: white;
            border-color: white;
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .year-input::placeholder {
            color: #999;
            font-weight: normal;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 20px;
            border-radius: 15px;
        }

        .weekday {
            text-align: center;
            padding: 15px 0;
            font-weight: bold;
            color: #4ECDC4;
            font-size: 16px;
            border-bottom: 2px solid #4ECDC4;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .calendar-day.weekend {
            background: linear-gradient(135deg, #fff9e6, #ffe6cc);
            border-color: #ffcc80;
        }

        /* Èº†Ê†áÊÇ¨ÂÅúÊèêÁ§∫Ê°ÜÊ†∑Âºè */
        .date-tooltip {
            position: fixed;
            background: rgba(255, 255, 255, 0.98);
            border: 1px solid #ddd;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 20px;
            min-width: 320px;
            max-width: 400px;
            z-index: 1000;
            backdrop-filter: blur(10px);
            display: none;
            font-family: 'Microsoft YaHei', 'PingFang SC', sans-serif;
            /* Âõ∫ÂÆöÂú®Âè≥‰∏ãËßí */
            right: 20px;
            bottom: 20px;
            left: auto;
            top: auto;
        }

        .tooltip-copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 1001;
            pointer-events: auto;
            box-shadow: 0 2px 8px rgba(78, 205, 196, 0.3);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tooltip-copy-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 12px rgba(78, 205, 196, 0.4);
        }

        .tooltip-copy-btn:active {
            transform: scale(0.95);
        }

        .date-tooltip.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tooltip-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .tooltip-date {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }

        .tooltip-lunar {
            font-size: 14px;
            color: #666;
            margin-top: 2px;
        }

        .tooltip-jieqi {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px 12px;
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
            border-radius: 8px;
            border-left: 3px solid #4ECDC4;
        }

        .tooltip-jieqi img {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            margin-right: 15px;
            object-fit: cover;
            border: 2px solid rgba(78, 205, 196, 0.3);
        }

        .tooltip-jieqi-info {
            flex: 1;
        }

        .tooltip-jieqi-name {
            font-weight: bold;
            color: #4ECDC4;
            font-size: 14px;
        }

        .tooltip-jieqi-desc {
            font-size: 12px;
            color: #666;
            margin-top: 2px;
        }

        /* ‰∏â‰ºè‰∏â‰πùÊ†∑Âºè */
        .tooltip-fu-jiu {
            margin: 10px 0;
            padding: 8px 12px;
            background: linear-gradient(135deg, #fff8f0, #fff0e6);
            border-radius: 8px;
            border-left: 3px solid #FFA500;
        }

        .tooltip-fu-jiu-title {
            font-size: 13px;
            font-weight: bold;
            color: #FFA500;
            margin-bottom: 6px;
        }

        .tooltip-fu-jiu-content {
            display: flex;
            gap: 10px;
        }

        #tooltipFu, #tooltipJiu {
            flex: 1;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
        }

        #tooltipFu {
            background: rgba(255, 107, 107, 0.1);
            color: #FF6B6B;
            border: 1px solid rgba(255, 107, 107, 0.3);
        }

        #tooltipJiu {
            background: rgba(78, 205, 196, 0.1);
            color: #4ECDC4;
            border: 1px solid rgba(78, 205, 196, 0.3);
        }

        .tooltip-festivals {
            margin: 10px 0;
        }

        .tooltip-festival-title {
            font-size: 14px;
            font-weight: bold;
            color: #FF6B6B;
            margin-bottom: 8px;
        }

        .tooltip-festival-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tooltip-festival-item {
            background: linear-gradient(135deg, #fff0f0, #ffe6e6);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            color: #d63384;
            border: 1px solid #ffcccc;
        }

        /* Êó•ÊúüËÆ°ÁÆó‰ø°ÊÅØÊ†∑Âºè */
        .tooltip-date-info {
            margin: 12px 0;
            padding: 10px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 6px;
            border-left: 2px solid #9C27B0;
            font-size: 11px;
        }

        .date-info-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 4px;
        }

        .date-info-item {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            gap: 2px;
            margin-bottom: 0;
        }

        .date-info-item:last-child {
            margin-bottom: 0;
        }

        .info-label {
            color: #666;
            font-weight: normal;
        }

        .info-value {
            color: #9C27B0;
            font-weight: bold;
            background: rgba(156, 39, 176, 0.1);
            padding: 1px 4px;
            border-radius: 3px;
            min-width: 20px;
            text-align: center;
            margin: 0 2px;
        }

        .tooltip-holiday {
            margin: 10px 0;
            padding: 8px 12px;
            background: linear-gradient(135deg, #f0fff0, #e6ffe6);
            border-radius: 8px;
            border-left: 3px solid #5CB85C;
        }

        .tooltip-holiday.rest {
            background: linear-gradient(135deg, #f0fff0, #e6ffe6);
            border-left-color: #5CB85C;
        }

        .tooltip-holiday.work {
            background: linear-gradient(135deg, #fff8e6, #fff0cc);
            border-left-color: #E6A23C;
        }

        .tooltip-holiday-symbol {
            font-weight: bold;
            font-size: 14px;
            margin-right: 6px;
        }

        .tooltip-holiday-name {
            font-weight: bold;
            font-size: 13px;
        }

        .calendar-day:hover {
            border-color: #4ECDC4;
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
            z-index: 10;
        }

        .calendar-day.selected {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
            border-color: #4ECDC4;
        }

        .calendar-day.other-month {
            opacity: 0.4;
            background: #f8f9fa;
        }

        .calendar-day.today {
            background: linear-gradient(135deg, #FF6B6B, #E6A23C);
            color: white;
            border-color: #FF6B6B;
            font-weight: bold;
        }

        .day-number {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .lunar-day {
            font-size: 11px;
            color: #666;
            text-align: center;
        }

        .festival-tag {
            position: absolute;
            top: 2px;
            left: 50%;
            transform: translateX(-50%);
            background: #FF6B6B;
            color: white;
            font-size: 9px;
            padding: 1px 4px;
            border-radius: 8px;
            font-weight: bold;
            z-index: 10;
            white-space: nowrap;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            pointer-events: none; /* Èò≤Ê≠¢Êã¶Êà™Èº†Ê†á‰∫ã‰ª∂ */
        }

        .festival-tag:hover {
            transform: translateX(-50%) scale(1.1);
            box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);
            z-index: 11;
        }

        .jieqi-tag {
            position: absolute;
            bottom: 2px;
            left: 2px;
            background: #4ECDC4;
            color: white;
            font-size: 8px;
            padding: 1px 4px;
            border-radius: 5px;
            z-index: 10;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .jieqi-tag:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(78, 205, 196, 0.4);
            z-index: 11;
        }

        /* ‰∏â‰πù‰ø°ÊÅØÊ†áÁ≠æ - ÊîæÂú®Âè≥‰∏ãËßí */
        .fu-jiu-tag {
            position: absolute;
            bottom: 2px;
            right: 2px;
            background: #FFA500;
            color: white;
            font-size: 7px;
            padding: 1px 3px;
            border-radius: 4px;
            z-index: 10;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            font-weight: bold;
        }

        .fu-jiu-tag:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(255, 165, 0, 0.4);
            z-index: 11;
        }



        .holiday-tag {
            position: absolute;
            top: 2px;
            right: 2px;
            color: white;
            font-size: 9px;
            padding: 1px 4px;
            border-radius: 8px;
            font-weight: bold;
            z-index: 10;
            white-space: nowrap;
            pointer-events: none;
        }

        /* ‰ºëÂÅáÁî®ÁªøËâ≤ */
        .holiday-tag.rest {
            background: #5CB85C;
        }

        /* Ë∞É‰ºëÁî®ÈªÑËâ≤ */
        .holiday-tag.work {
            background: #E6A23C;
        }



        .empty-state {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 40px 20px;
        }

        .huangli {
            background: white;
            padding: 8px;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .solar-date {
            font-size: 14px;
            font-weight: bold;
            color: #4ECDC4;
            margin: 0;
            text-align: left;
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
            padding: 4px 8px;
            border-radius: 0 6px 6px 0;
            border-left: 3px solid #4ECDC4;
            align-self: flex-start;
        }

        #md {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            text-align: center;
            margin: 0;
        }

        #ymd {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
            margin: 0;
        }

        #ymd i {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-style: normal;
        }

        .nayin, .chongsha, .pengzu {
            display: flex;
            align-items: center;
            margin-bottom: 4px;
            padding: 4px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .nayin b, .chongsha b, .pengzu b {
            color: #4ECDC4;
            font-size: 13px;
            margin-right: 10px;
            min-width: 40px;
        }

        .nayin i, .chongsha i, .pengzu i {
            color: #666;
            font-size: 12px;
            font-style: normal;
        }

        .fangwei-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            padding: 4px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .fangwei-item {
            flex: 1;
            text-align: center;
            padding: 4px;
        }

        .fangwei-item b {
            display: block;
            color: #4ECDC4;
            font-size: 11px;
            margin-bottom: 2px;
        }

        .fangwei-item i {
            display: block;
            color: #666;
            font-size: 11px;
            font-style: normal;
        }

        .festival-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .festival-title {
            font-size: 14px;
            font-weight: bold;
            color: #4ECDC4;
            margin-bottom: 10px;
        }

        .jieqi-status-container {
            margin-bottom: 10px;
        }

        .jieqi-status {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            margin-bottom: 5px;
            line-height: 1.4;
        }

        .jieqi-status.today {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
            font-weight: bold;
        }

        .jieqi-status.upcoming {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            color: #856404;
        }

        .festival-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .festival-item {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            color: #666;
        }

        .festival-item.jieqi {
            background: linear-gradient(135deg, #4ECDC4, #44A08D);
            color: white;
        }

        .festival-item.holiday {
            background: linear-gradient(135deg, #FF6B6B, #E6A23C);
            color: white;
        }

        .upcoming-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .upcoming-title {
            font-size: 14px;
            font-weight: bold;
            color: #FF6B6B;
            margin-bottom: 10px;
        }

        .upcoming-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .upcoming-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 13px;
            transition: transform 0.2s ease;
        }

        .upcoming-item:hover {
            transform: translateX(5px);
        }

        .upcoming-name {
            color: #856404;
            font-weight: bold;
        }

        .upcoming-days {
            color: #d63384;
            font-weight: bold;
            background: rgba(255, 255, 255, 0.5);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }

        /* ËäÇÂÅáÊó•Ê†∑Âºè */
        .holiday-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }

        .holiday-title {
            font-size: 14px;
            font-weight: bold;
            color: #5CB85C;
            margin-bottom: 10px;
        }

        .holiday-status {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.4;
        }

        .holiday-status.rest {
            background: linear-gradient(135deg, #5CB85C, #4CAE4C);
            color: white;
        }

        .holiday-status.work {
            background: linear-gradient(135deg, #E6A23C, #D68910);
            color: white;
        }

        .holiday-icon {
            font-size: 16px;
            margin-right: 8px;
        }

        .holiday-symbol {
            font-size: 18px;
            font-weight: bold;
            margin-right: 8px;
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
            min-width: 24px;
            text-align: center;
        }

        .holiday-name {
            font-weight: bold;
            margin-right: 8px;
        }

        .holiday-type {
            font-size: 12px;
            opacity: 0.9;
        }

        .weekstart-selector {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 2px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .weekstart-option {
            padding: 6px 12px;
            cursor: pointer;
            border-radius: 16px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
            user-select: none;
            white-space: nowrap;
        }

        .weekstart-option.active {
            background: white;
            color: #2196F3;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .weekstart-option:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
        }

        .yishen-container {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            gap: 10px;
        }

        #yi, #ji {
            flex: 2;
            margin: 0;
            padding: 8px 6px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            min-height: 110px;
        }

        #jshen, #xshen {
            flex: 1;
            margin: 0;
            padding: 10px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            min-height: 120px;
        }

        .yiji-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(30px, 1fr));
            gap: 2px;
            align-items: start;
            justify-items: center;
        }

        .shen-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            align-items: start;
        }

        .yiji {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        }

        .yiji b, #jshen b {
            color: #4ECDC4;
            font-size: 1rem;
            margin-right: 8px;
            display: block;
            margin-bottom: 6px;
            text-align: center;
        }

        .yiji.ji {
            background: linear-gradient(135deg, #ffe6e6, #ffcccc);
        }

        .yiji.ji b, #xshen b {
            color: #FF6B6B;
            font-size: 1rem;
            margin-right: 8px;
            display: block;
            margin-bottom: 6px;
            text-align: center;
        }

        .yiji i {
            color: #666;
            font-size: 10px;
            font-style: normal;
            text-align: center;
            padding: 2px 4px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 3px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            white-space: nowrap;
            min-width: fit-content;
            max-width: 100%;
            box-sizing: border-box;
            line-height: 1.2;
        }

        .shen i {
            color: #666;
            font-size: 10px;
            font-style: normal;
            text-align: center;
            padding: 2px 3px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 3px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            width: 100%;
            box-sizing: border-box;
            line-height: 1.2;
        }

        #jshen {
            background: linear-gradient(135deg, #f0f8ff, #e6f3ff);
        }

        #xshen {
            background: linear-gradient(135deg, #fff5f5, #ffe6e6);
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
                align-items: center;
            }

            .detail-section {
                width: 100%;
                max-width: none;
            }
        }

        /* ÊâãÊú∫Á´Ø‰ºòÂåñ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .main-container {
                padding: 15px;
                gap: 15px;
                border-radius: 15px;
            }

            .calendar-section {
                width: 100%;
            }

            .detail-section {
                min-width: auto;
                max-width: none;
            }

            /* Êó•ÂéÜÂ§¥ÈÉ®‰ºòÂåñ */
            .calendar-header {
                flex-wrap: wrap;
                gap: 8px;
                padding: 12px;
                justify-content: center;
            }

            .nav-btn {
                padding: 6px 10px;
                font-size: 12px;
            }

            .today-btn {
                padding: 6px 10px;
            }

            /* Êó•ÊúüÈÄâÊã©Âô®Âå∫Âüü - ‰∏äÊúà/‰∏ãÊúà/Âπ¥ÊúàÂú®Âêå‰∏ÄË°å */
            .date-selector {
                display: flex;
                align-items: center;
                gap: 6px;
                flex-shrink: 0;
            }

            .mobile-prev-btn {
                padding: 6px 10px;
                font-size: 12px;
            }

            .year-input {
                width: 60px !important;
                min-width: 60px !important;
                font-size: 13px;
                padding: 5px 6px;
                text-align: center;
            }

            .month-select {
                font-size: 11px;
                padding: 5px 6px;
            }

            .mobile-next-btn {
                padding: 6px 10px;
                font-size: 12px;
            }

            /* ÈöêËóèÂéüÂßãÁöÑ‰∏äÊúà‰∏ãÊúàÊåâÈíÆ */
            .nav-btn[onclick="changeMonth(-1)"]:not(.mobile-prev-btn),
            .nav-btn[onclick="changeMonth(1)"]:not(.mobile-next-btn) {
                display: none;
            }

            .today-btn {
                order: 1;
            }

            .festival-selector,
            .theme-selector,
            .weekstart-selector {
                order: 2;
            }

            /* ÊòüÊúüÈÄâÊã©Âô®ÁÆÄÂåñ */
            .weekstart-selector {
                padding: 2px;
            }

            .weekstart-option {
                padding: 4px 8px;
                font-size: 11px;
            }

            /* Êó•ÂéÜÁΩëÊ†º‰ºòÂåñ */
            .calendar-grid {
                gap: 4px;
                padding: 10px;
                border-radius: 10px;
            }

            .weekday {
                padding: 8px 0;
                font-size: 12px;
            }

            .calendar-day {
                border-width: 1px;
                border-radius: 8px;
                padding: 0;
                aspect-ratio: 1;
                min-height: 40px;
            }

            .day-number {
                font-size: 14px;
                margin-bottom: 2px;
                line-height: 1.2;
            }

            .lunar-day {
                font-size: 9px;
                line-height: 1.1;
            }

            /* Ê†áÁ≠æ‰ºòÂåñ - ÁßªÂä®Á´ØËäÇÊó•Ê†áÁ≠æÁº©Â∞èÔºåÈÅøÂÖçÈÅÆÊå°Êó•Êúü */
            .festival-tag {
                font-size: 2px;
                padding: 0;
                top: 1px;
                max-width: calc(100% - 4px);
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                transform: translateX(-50%);
                left: 50%;
                right: auto;
                border-radius: 3px;
                line-height: 1;
                min-height: 8px;
                background: transparent;
                z-index: 1; /* ËäÇÊó•Ê†áÁ≠æÂ±ÇÁ∫ßÊõ¥‰Ωé */
            }

            .day-number {
                position: relative;
                z-index: 2; /* Êó•ÊúüÊï∞Â≠óÂ±ÇÁ∫ßÊõ¥È´ò */
            }

            .jieqi-tag,
            .fu-jiu-tag {
                display: none;
            }

            /* ÊâãÊú∫Á´Ø‰ºëÂÅáÁî®Â∞èÂúÜÁÇπÊòæÁ§∫ */
            .holiday-tag {
                width: 7px;
                height: 7px;
                border-radius: 50%;
                padding: 0;
                font-size: 0;
                top: 2px;
                right: 2px;
                color: transparent;
            }

            .holiday-tag.rest {
                background: #5CB85C;
            }

            .holiday-tag.work {
                background: #E6A23C;
            }

            /* ÈªÑÂéÜËØ¶ÊÉÖÈù¢Êùø‰ºòÂåñ */
            #detailPanel {
                padding: 12px;
            }

            .solar-date {
                font-size: 13px;
            }

            .nayin b, .chongsha b, .pengzu b {
                font-size: 11px;
            }

            .nayin i, .chongsha i, .pengzu i {
                font-size: 10px;
            }

            #yi, #ji, #jshen, #xshen {
                min-height: auto;
                padding: 6px;
            }

            /* ÂêâÁ•û„ÄÅÂá∂Á•ûÊ†áÈ¢òÂ±Ö‰∏≠‰∏îÂú®‰∏ÄË°åÊòæÁ§∫ */
            .yiji b, #jshen b, .yiji.ji b, #xshen b {
                text-align: center !important;
                margin: 0 !important;
                padding: 0 !important;
                white-space: nowrap !important;
            }

            .yiji i, .shen i {
                font-size: 9px;
            }

            /* ÊèêÁ§∫Ê°Ü‰ºòÂåñ */
            .date-tooltip {
                position: fixed;
                left: 10px !important;
                right: 10px !important;
                bottom: 10px !important;
                top: auto !important;
                max-width: none !important;
                min-width: auto !important;
                padding: 15px;
            }

            .tooltip-header {
                margin-bottom: 10px;
            }

            .tooltip-date {
                font-size: 16px;
            }

            .tooltip-lunar {
                font-size: 12px;
            }

            /* Á©∫Áä∂ÊÄÅ‰ºòÂåñ */
            .empty-state {
                padding: 20px 10px;
                font-size: 13px;
            }

            /* ËäÇÊó•Âíå‰∏ªÈ¢ò‰∏ãÊãâËèúÂçï‰ºòÂåñ */
            .festival-dropdown,
            .theme-dropdown {
                position: fixed;
                left: 10px;
                right: 10px;
                width: auto;
                min-width: auto;
                max-width: none;
                top: 50%;
                transform: translateY(-50%);
            }
        }

        /* Ë∂ÖÂ∞èÂ±èÂπï‰ºòÂåñ */
        @media (max-width: 360px) {
            .main-container {
                padding: 10px;
            }

            .calendar-day {
                min-height: 35px;
            }

            .day-number {
                font-size: 12px;
            }

            .lunar-day {
                font-size: 8px;
            }

            .festival-tag,
            .jieqi-tag,
            .holiday-tag,
            .fu-jiu-tag {
                display: none;
            }
        }
        body.dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        body.dark-theme .main-container {
            background: rgba(30, 30, 46, 0.95);
            color: #e0e0e0;
        }

        body.dark-theme .calendar-header {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        body.dark-theme .nav-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        body.dark-theme .nav-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        body.dark-theme .year-input, 
        body.dark-theme .month-select {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
        }

        body.dark-theme .year-input:focus, 
        body.dark-theme .month-select:focus {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
        }

        body.dark-theme .calendar-grid {
            background: rgba(30, 30, 46, 0.8);
        }

        body.dark-theme .calendar-day {
            background: rgba(50, 50, 70, 0.8);
            border: 2px solid #4a5568;
            color: #e0e0e0;
        }

        body.dark-theme .calendar-day:hover {
            border-color: #2196F3;
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        body.dark-theme .calendar-day.weekend:hover {
            border-color: #b8860b;
            box-shadow: 0 5px 15px rgba(184, 134, 11, 0.3);
        }

        body.dark-theme .calendar-day.selected {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            border-color: #2196F3;
        }

        body.dark-theme .calendar-day.today {
            background: linear-gradient(135deg, #FF6B6B, #E6A23C);
            border-color: #FF6B6B;
        }

        body.dark-theme .calendar-day.weekend {
            background: linear-gradient(135deg, #3d3220, #4a3920);
            border-color: #b8860b;
        }

        body.dark-theme .weekday {
            color: #2196F3;
            border-bottom-color: #2196F3;
        }

        body.dark-theme .lunar-day {
            color: #a0a0a0;
        }

        body.dark-theme .date-tooltip {
            background: rgba(30, 30, 46, 0.98);
            border: 1px solid #4a5568;
            color: #e0e0e0;
        }

        body.dark-theme .tooltip-date-info {
            background: linear-gradient(135deg, #2d3748, #1a202c);
            border-left-color: #2196F3;
        }

        body.dark-theme .tooltip-copy-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
        }

        body.dark-theme .info-label {
            color: #a0a0a0;
        }

        body.dark-theme .info-value {
            color: #2196F3;
            background: rgba(33, 150, 243, 0.1);
        }

        body.dark-theme .huangli {
            background: rgba(30, 30, 46, 0.9);
            color: #e0e0e0;
        }

        body.dark-theme .solar-date {
            background: linear-gradient(135deg, #1e3a8a, #1e40af);
            color: white;
            border-left-color: #2196F3;
        }

        body.dark-theme .yiji {
            background: linear-gradient(135deg, #2d3748, #1a202c);
        }

        body.dark-theme .yiji.ji {
            background: linear-gradient(135deg, #4a1a1a, #2d1818);
        }

        body.dark-theme .yiji i,
        body.dark-theme .shen i {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #a0a0a0;
        }

        body.dark-theme .festival-dropdown,
        body.dark-theme .theme-dropdown {
            background: #2d3748;
            border: 1px solid #4a5568;
        }

        body.dark-theme .festival-option,
        body.dark-theme .theme-option {
            color: #e0e0e0;
        }

        body.dark-theme .festival-option:hover,
        body.dark-theme .theme-option:hover {
            background-color: #4a5568;
        }

        body.dark-theme .festival-option span,
        body.dark-theme .theme-option span {
            color: #e0e0e0;
        }

        /* ‰∏ªÈ¢òÂàáÊç¢Âä®Áîª */
        body {
            transition: background 0.3s ease;
        }

        .main-container,
        .calendar-day,
        .date-tooltip,
        .huangli,
        .tooltip-date-info,
        .yiji,
        .festival-dropdown,
        .theme-dropdown {
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease;
        }

        @media (max-width: 768px) {
            .main-container {
                padding: 20px;
                gap: 20px;
            }

            .calendar-grid {
                gap: 5px;
                padding: 15px;
            }

            .day-number {
                font-size: 16px;
            }

            .detail-panel {
                padding: 20px;
            }
        }

        /* ÊèêÁ§∫Ê∂àÊÅØÊ†∑Âºè - È°∂ÈÉ®‰∏≠Èó¥ÊòæÁ§∫ */
        .toast-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 9999;
            animation: toastFade 0.3s ease;
        }

        @keyframes toastFade {
            from { opacity: 0; transform: translateX(-50%) translateY(-10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <section class="calendar-section">
            <div class="calendar-header">
                <button class="nav-btn mobile-prev-btn" onclick="changeMonth(-1)">‰∏äÊúà</button>
                <div class="date-selector">
                    <input type="number" class="year-input" id="yearInput" placeholder="Âπ¥‰ªΩ" min="1900" max="2100" onchange="updateCalendar()">
                    <select class="month-select" id="monthSelect" onchange="updateCalendar()">
                        <option value="1">‰∏ÄÊúà</option>
                        <option value="2">‰∫åÊúà</option>
                        <option value="3">‰∏âÊúà</option>
                        <option value="4">ÂõõÊúà</option>
                        <option value="5">‰∫îÊúà</option>
                        <option value="6">ÂÖ≠Êúà</option>
                        <option value="7">‰∏ÉÊúà</option>
                        <option value="8">ÂÖ´Êúà</option>
                        <option value="9">‰πùÊúà</option>
                        <option value="10">ÂçÅÊúà</option>
                        <option value="11">ÂçÅ‰∏ÄÊúà</option>
                        <option value="12">ÂçÅ‰∫åÊúà</option>
                    </select>
                </div>
                <button class="nav-btn mobile-next-btn" onclick="changeMonth(1)">‰∏ãÊúà</button>
                <div class="festival-selector">
                    <button class="nav-btn festival-toggle" onclick="toggleFestivalSelector()">ËäÇÊó•</button>
                    <div class="festival-dropdown" id="festivalDropdown">
                        <label class="festival-option">
                            <input type="checkbox" id="showSolarFestivals" onchange="updateFestivalSettings()" checked>
                            <span>Èò≥ÂéÜËäÇÊó•</span>
                        </label>
                        <label class="festival-option">
                            <input type="checkbox" id="showLunarFestivals" onchange="updateFestivalSettings()" checked>
                            <span>ÂÜúÂéÜËäÇÊó•</span>
                        </label>
                        <label class="festival-option">
                            <input type="checkbox" id="showJieqi" onchange="updateFestivalSettings()" checked>
                            <span>ËäÇÊ∞î</span>
                        </label>
                        <label class="festival-option">
                            <input type="checkbox" id="showWeekFestivals" onchange="updateFestivalSettings()" checked>
                            <span>ÊòüÊúüËäÇÊó•</span>
                        </label>
                        <label class="festival-option">
                            <input type="checkbox" id="showOtherFestivals" onchange="updateFestivalSettings()" checked>
                            <span>ÂÖ∂‰ªñËäÇÊó•</span>
                        </label>
                    </div>
                </div>
                <div class="weekstart-selector">
                    <div class="weekstart-option active" data-value="1" onclick="toggleWeekStart(1)">Âë®‰∏Ä</div>
                    <div class="weekstart-option" data-value="0" onclick="toggleWeekStart(0)">Âë®Êó•</div>
                </div>
                <div class="theme-selector">
                    <button class="nav-btn theme-toggle" onclick="toggleThemeSelector()">‰∏ªÈ¢ò</button>
                    <div class="theme-dropdown" id="themeDropdown">
                        <div class="theme-option" data-theme="light" onclick="setTheme('light')">
                            <span class="theme-icon">‚òÄÔ∏è</span>
                            <span>ÊµÖËâ≤Ê®°Âºè</span>
                        </div>
                        <div class="theme-option" data-theme="dark" onclick="setTheme('dark')">
                            <span class="theme-icon">üåô</span>
                            <span>Ê∑±Ëâ≤Ê®°Âºè</span>
                        </div>
                        <div class="theme-option" data-theme="system" onclick="setTheme('system')">
                            <span class="theme-icon">üíª</span>
                            <span>Ë∑üÈöèÁ≥ªÁªü</span>
                        </div>
                    </div>
                </div>
                <button class="nav-btn today-btn" onclick="goToToday()">‰ªäÂ§©</button>
            </div>
            <div class="calendar-grid" id="calendarGrid">
                <!-- ÊòüÊúüÊ†áÈ¢ò -->
                <div class="weekday">Êó•</div>
                <div class="weekday">‰∏Ä</div>
                <div class="weekday">‰∫å</div>
                <div class="weekday">‰∏â</div>
                <div class="weekday">Âõõ</div>
                <div class="weekday">‰∫î</div>
                <div class="weekday">ÂÖ≠</div>
                <!-- Êó•ÊúüÂ∞ÜÈÄöËøáJavaScriptÁîüÊàê -->
            </div>
        </section>

        <aside class="detail-section">
            <div id="detailPanel" class="huangli">
                <div class="empty-state">
                    <p>üìÖ Ê≠£Âú®Âä†ËΩΩÈªÑÂéÜ‰ø°ÊÅØ...</p>
                    <p style="margin-top: 10px; font-size: 14px;">ËØ∑Á®çÂÄô</p>
                </div>
            </div>
        </aside>
    </div>

    <!-- Êó•ÊúüÊèêÁ§∫Ê°Ü -->
    <div id="dateTooltip" class="date-tooltip">
        <button class="tooltip-copy-btn" onclick="copyTooltipContent()" title="Â§çÂà∂ÂÖ®ÈÉ®">üìã</button>
        <div class="tooltip-header">
            <div>
                <div class="tooltip-date" id="tooltipSolarDate"></div>
                <div class="tooltip-lunar" id="tooltipLunarDate"></div>
            </div>
        </div>
        
        <!-- Êó•ÊúüËÆ°ÁÆó‰ø°ÊÅØ -->
        <div class="tooltip-date-info" id="tooltipDateInfo" style="display: none;">
            <div class="date-info-row">
                <div class="date-info-item">
                    <span class="info-label">Á¨¨</span>
                    <span class="info-value" id="tooltipWeekOfYear"></span>
                    <span class="info-label">Âë®/Ââ©</span>
                    <span class="info-value" id="tooltipWeeksRemaining"></span>
                    <span class="info-label">Âë®</span>
                </div>
                <div class="date-info-item">
                    <span class="info-label">ÂÖ±</span>
                    <span class="info-value" id="tooltipTotalWeeks"></span>
                    <span class="info-label">Âë®</span>
                </div>
            </div>
            <div class="date-info-row">
                <div class="date-info-item">
                    <span class="info-label">Á¨¨</span>
                    <span class="info-value" id="tooltipDayOfYear"></span>
                    <span class="info-label">Â§©/Ââ©</span>
                    <span class="info-value" id="tooltipDaysRemaining"></span>
                    <span class="info-label">Â§©</span>
                </div>
                <div class="date-info-item">
                    <span class="info-label">ÂÖ±</span>
                    <span class="info-value" id="tooltipTotalDays"></span>
                    <span class="info-label">Â§©</span>
                </div>
            </div>
            <div class="date-info-item">
                <span class="info-label">‰∏ã‰∏™ËäÇÊó•Ôºö</span>
                <span class="info-value" id="tooltipNextFestival"></span>
            </div>
        </div>
        
        <div id="tooltipJieqi" class="tooltip-jieqi" style="display: none;">
            <img id="tooltipJieqiImg" src="" alt="">
            <div class="tooltip-jieqi-info">
                <div class="tooltip-jieqi-name" id="tooltipJieqiName"></div>
                <div class="tooltip-jieqi-desc" id="tooltipJieqiDesc"></div>
            </div>
        </div>
        <div id="tooltipFuJiu" class="tooltip-fu-jiu" style="display: none;">
            <div class="tooltip-fu-jiu-title">‰º†ÁªüËäÇÊ∞î</div>
            <div class="tooltip-fu-jiu-content">
                <div id="tooltipFu"></div>
                <div id="tooltipJiu"></div>
            </div>
        </div>
        <div id="tooltipHoliday" class="tooltip-holiday" style="display: none;">
            <span class="tooltip-holiday-symbol" id="tooltipHolidaySymbol"></span>
            <span class="tooltip-holiday-name" id="tooltipHolidayName"></span>
        </div>
        <div id="tooltipFestivals" class="tooltip-festivals" style="display: none;">
            <div class="tooltip-festival-title">ËäÇÊó•</div>
            <div class="tooltip-festival-list" id="tooltipFestivalList"></div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÁä∂ÊÄÅ
        const state = {
            currentDate: new Date(),
            selectedDate: null,
            currentYear: new Date().getFullYear(),
            currentMonth: new Date().getMonth() + 1,
            weekStart: 0, // 0=Âë®Êó•ÂºÄÂßã, 1=Âë®‰∏ÄÂºÄÂßã
            festivalSettings: {
                showSolarFestivals: true,   // Èò≥ÂéÜËäÇÊó•
                showLunarFestivals: true,   // ÂÜúÂéÜËäÇÊó•
                showJieqi: true,            // ËäÇÊ∞î
                showOtherFestivals: true,   // ÂÖ∂‰ªñËäÇÊó•ÔºàÂåÖÊã¨Âë®ÊÅ©Êù•ÈÄù‰∏ñÁ∫™ÂøµÊó•„ÄÅ‰∏≠ÂõΩ‰∫∫Ê∞ëË≠¶ÂØüËäÇÁ≠âÔºâ
                showWeekFestivals: true     // ÊåâÊòüÊúüÁöÑËäÇÊó•
            }
        };

        // ËäÇÊ∞îÊï∞ÊçÆ
        const jieqiData = {
            'Á´ãÊò•': '#4ECDC4', 'Èõ®Ê∞¥': '#4ECDC4', 'ÊÉäËõ∞': '#4ECDC4', 'Êò•ÂàÜ': '#4ECDC4',
            'Ê∏ÖÊòé': '#4ECDC4', 'Ë∞∑Èõ®': '#4ECDC4', 'Á´ãÂ§è': '#FF6B6B', 'Â∞èÊª°': '#FF6B6B',
            'ËäíÁßç': '#FF6B6B', 'Â§èËá≥': '#FF6B6B', 'Â∞èÊöë': '#FF6B6B', 'Â§ßÊöë': '#FF6B6B',
            'Á´ãÁßã': '#E6A23C', 'Â§ÑÊöë': '#E6A23C', 'ÁôΩÈú≤': '#E6A23C', 'ÁßãÂàÜ': '#E6A23C',
            'ÂØíÈú≤': '#E6A23C', 'ÈúúÈôç': '#E6A23C', 'Á´ãÂÜ¨': '#764ba2', 'Â∞èÈõ™': '#764ba2',
            'Â§ßÈõ™': '#764ba2', 'ÂÜ¨Ëá≥': '#764ba2', 'Â∞èÂØí': '#764ba2', 'Â§ßÂØí': '#764ba2'
        };

        // ËäÇÊ∞îÊèèËø∞‰ø°ÊÅØ
        const jieqiDesc = {
            'Á´ãÊò•': 'Êò•Â≠£ÂºÄÂßãÔºå‰∏áÁâ©Â§çËãèÔºåÂ§©Ê∞îÊ∏êÊöñ',
            'Èõ®Ê∞¥': 'ÈôçÈõ®ÂºÄÂßãÔºåÈõ®ÈáèÊ∏êÂ¢ûÔºåÊò•ÊÑèÁõéÁÑ∂',
            'ÊÉäËõ∞': 'Êò•Èõ∑ÂßãÈ∏£ÔºåËõ∞Ëô´ÊÉäÈÜíÔºåÁîüÊú∫ÂãÉÂãÉ',
            'Êò•ÂàÜ': 'ÊòºÂ§úÂπ≥ÂàÜÔºåÊò•ÊöñËä±ÂºÄÔºåÊí≠ÁßçÊó∂ËäÇ',
            'Ê∏ÖÊòé': 'Â§©Ê∞îÊ∏ÖÊúóÔºåËçâÊú®ÁπÅËåÇÔºåÊâ´Â¢ìÁ•≠Á•ñ',
            'Ë∞∑Èõ®': 'Èõ®ÁîüÁôæË∞∑Ôºå‰ΩúÁâ©ÁîüÈïøÔºåÊò•ËÄïÂøôÁ¢å',
            'Á´ãÂ§è': 'Â§èÂ≠£ÂºÄÂßãÔºåÊ∞îÊ∏©ÂçáÈ´òÔºå‰∏áÁâ©ÁîüÈïø',
            'Â∞èÊª°': 'È∫¶Á±ªÁ≠âÂ§èÁÜü‰ΩúÁâ©Á±ΩÁ≤íÂºÄÂßãÈ•±Êª°',
            'ËäíÁßç': 'ÊúâËäí‰ΩúÁâ©ÊàêÁÜüÔºåÊôöË∞∑Êí≠ÁßçÊó∂ËäÇ',
            'Â§èËá≥': 'ÁôΩÊòºÊúÄÈïøÔºåÁõõÂ§èÊù•‰∏¥ÔºåÁÇéÁÉ≠ÂºÄÂßã',
            'Â∞èÊöë': 'Â§©Ê∞îÂºÄÂßãÁÇéÁÉ≠Ôºå‰ΩÜËøòÊú™Âà∞ÊúÄÁÉ≠',
            'Â§ßÊöë': '‰∏ÄÂπ¥‰∏≠ÊúÄÁÉ≠ÁöÑÊó∂ÊúüÔºåÈÖ∑ÁÉ≠ÈöæËÄê',
            'Á´ãÁßã': 'ÁßãÂ≠£ÂºÄÂßãÔºåÂ§©Ê∞îËΩ¨ÂáâÔºåÊî∂Ëé∑Êó∂ËäÇ',
            'Â§ÑÊöë': 'ÁÇéÁÉ≠Â§©Ê∞îÁªìÊùüÔºåÊöëÊ∞îÊ∂àÈÄÄ',
            'ÁôΩÈú≤': 'Â§©Ê∞îËΩ¨ÂáâÔºåÈú≤Ê∞¥ÂáùÁªìÔºåÁßãÊÑèÊ∏êÊµì',
            'ÁßãÂàÜ': 'ÊòºÂ§úÂπ≥ÂàÜÔºåÁßãÈ´òÊ∞îÁàΩÔºå‰∏∞Êî∂Â≠£ËäÇ',
            'ÂØíÈú≤': 'Èú≤Ê∞¥Â∑≤ÂØíÔºåÊ∞îÊ∏©‰∏ãÈôçÔºåÁßãÊ∑±Èú≤Èáç',
            'ÈúúÈôç': 'Â§©Ê∞îÊ∏êÂÜ∑ÔºåÂºÄÂßãÈôçÈúúÔºåÁßãÂéªÂÜ¨Êù•',
            'Á´ãÂÜ¨': 'ÂÜ¨Â≠£ÂºÄÂßãÔºå‰∏áÁâ©Êî∂ËóèÔºåÂ§©Ê∞îÂØíÂÜ∑',
            'Â∞èÈõ™': 'ÂºÄÂßãÈôçÈõ™Ôºå‰ΩÜÈõ™Èáè‰∏çÂ§ß',
            'Â§ßÈõ™': 'ÈôçÈõ™Â¢ûÂ§öÔºåÂú∞Èù¢ÂèØËÉΩÁßØÈõ™',
            'ÂÜ¨Ëá≥': 'ÁôΩÊòºÊúÄÁü≠ÔºåÈªëÂ§úÊúÄÈïøÔºåÊï∞‰πùÂºÄÂßã',
            'Â∞èÂØí': 'Â§©Ê∞îÂØíÂÜ∑Ôºå‰ΩÜËøòÊú™Âà∞ÊúÄÂÜ∑',
            'Â§ßÂØí': '‰∏ÄÂπ¥‰∏≠ÊúÄÂÜ∑ÁöÑÊó∂ÊúüÔºå‰∏•ÂØíÂà∫È™®'
        };

        // ËäÇÊ∞îÂõæÁâáË∑ØÂæÑÈÖçÁΩÆ
        const JIEQI_IMAGE_PATH = 'imgs/';
        
        // ËäÇÊ∞îÂõæÁâáÊñá‰ª∂ÂêçÊò†Â∞Ñ
        const jieqiImageFiles = {
            'Á´ãÊò•': 'li_chun.webp',
            'Èõ®Ê∞¥': 'yu_shui.webp',
            'ÊÉäËõ∞': 'jing_zhe.webp',
            'Êò•ÂàÜ': 'chun_fen.webp',
            'Ê∏ÖÊòé': 'qing_ming.webp',
            'Ë∞∑Èõ®': 'gu_yu.webp',
            'Á´ãÂ§è': 'li_xia.webp',
            'Â∞èÊª°': 'xiao_man.webp',
            'ËäíÁßç': 'mang_zhong.webp',
            'Â§èËá≥': 'xia_zhi.webp',
            'Â∞èÊöë': 'xiao_shu.webp',
            'Â§ßÊöë': 'da_shu.webp',
            'Á´ãÁßã': 'li_qiu.webp',
            'Â§ÑÊöë': 'chu_shu.webp',
            'ÁôΩÈú≤': 'bai_lu.webp',
            'ÁßãÂàÜ': 'qiu_fen.webp',
            'ÂØíÈú≤': 'han_lu.webp',
            'ÈúúÈôç': 'shuang_jiang.webp',
            'Á´ãÂÜ¨': 'li_dong.webp',
            'Â∞èÈõ™': 'xiao_xue.webp',
            'Â§ßÈõ™': 'da_xue.webp',
            'ÂÜ¨Ëá≥': 'dong_zhi.webp',
            'Â∞èÂØí': 'xiao_han.webp',
            'Â§ßÂØí': 'da_han.webp'
        };
        
        // Ëé∑ÂèñËäÇÊ∞îÂÆåÊï¥ÂõæÁâáË∑ØÂæÑÁöÑÂáΩÊï∞
        function getJieqiImagePath(jieqiName) {
            const fileName = jieqiImageFiles[jieqiName];
            return fileName ? JIEQI_IMAGE_PATH + fileName : '';
        }

        // ÂàùÂßãÂåñÊó•ÂéÜ
        function init() {
            // Ê£ÄÊü•lunar.jsÊòØÂê¶Âä†ËΩΩÂÆåÊàê
            if (typeof Solar === 'undefined') {
                console.error('lunar.js Êú™Âä†ËΩΩÂÆåÊàê');
                return;
            }
            initializeSelectors();
            initializeWeekStartSettings();
            initializeFestivalSettings();
            initializeThemeSettings();
            renderCalendar();
            // ÈªòËÆ§ÊòæÁ§∫‰ªäÂ§©ÁöÑÈªÑÂéÜ‰ø°ÊÅØ
            showToday();
            
            // Ëá™Âä®Ê£ÄÊü•ÂΩìÂâçÊúà‰ªΩÊòØÂê¶Êúâ‰∏â‰πù‰ø°ÊÅØÂπ∂ÁªôÂá∫ÊèêÁ§∫
            setTimeout(checkFuJiuInfo, 1000);
        }
        
        // ÊâãÂä®ËÆ°ÁÆó‰∏â‰πù‰ø°ÊÅØ
        function calculateManualJiuInfo(solar) {
            try {
                // Ëé∑ÂèñÂÜ¨Ëá≥Êó•Êúü
                const dongzhi = Lunar.fromYmd(solar.getYear(), 12, 1).getJieQiTable()['ÂÜ¨Ëá≥'];
                if (!dongzhi) return null;
                
                // Ëé∑ÂèñÂÜ¨Ëá≥Êó•ÊúüÔºàÂÖºÂÆπ‰∏çÂêåÁâàÊú¨Ôºâ
                let dongzhiDate;
                if (typeof dongzhi.getSolar === 'function') {
                    dongzhiDate = dongzhi.getSolar();
                } else if (dongzhi.getYear && dongzhi.getMonth && dongzhi.getDay) {
                    dongzhiDate = Solar.fromYmd(dongzhi.getYear(), dongzhi.getMonth(), dongzhi.getDay());
                } else {
                    return null;
                }
                
                // ËÆ°ÁÆó‰ªéÂÜ¨Ëá≥ÂºÄÂßãÁöÑÂ§©Êï∞
                const daysAfterDongzhi = solar.subtract(dongzhiDate);
                
                // Â¶ÇÊûúÂ§©Êï∞Â∞è‰∫é0ÔºåËØ¥ÊòéÂú®ÂÜ¨Ëá≥ÂâçÔºåÊ≤°Êúâ‰∏â‰πù‰ø°ÊÅØ
                if (daysAfterDongzhi < 0) return null;
                
                // ËÆ°ÁÆóÂ±û‰∫éÁ¨¨Âá†‰∏™‰πùÂ§©
                const jiuNumber = Math.floor(daysAfterDongzhi / 9) + 1;
                
                // ‰∏â‰πùÂÖ±9‰∏™‰πùÂ§©ÔºåË∂ÖËøá81Â§©ÂàôÊ≤°Êúâ‰∏â‰πù‰ø°ÊÅØ
                if (jiuNumber > 9) return null;
                
                // ËøîÂõû‰∏â‰πù‰ø°ÊÅØ
                const jiuNames = ['‰∏Ä‰πù', '‰∫å‰πù', '‰∏â‰πù', 'Âõõ‰πù', '‰∫î‰πù', 'ÂÖ≠‰πù', '‰∏É‰πù', 'ÂÖ´‰πù', '‰πù‰πù'];
                const currentDayInJiu = daysAfterDongzhi % 9 + 1;
                
                return {
                    jiu: jiuNames[jiuNumber - 1],
                    dayInJiu: currentDayInJiu,
                    fullText: `${jiuNames[jiuNumber - 1]}Á¨¨${currentDayInJiu}Â§©`
                };
                
            } catch (error) {
                console.warn('ÊâãÂä®ËÆ°ÁÆó‰∏â‰πù‰ø°ÊÅØÂ§±Ë¥•:', error);
                return null;
            }
        }

        // Ê£ÄÊü•ÂΩìÂâçÊúà‰ªΩ‰∏â‰πù‰ø°ÊÅØÂπ∂ÁªôÂá∫Êô∫ËÉΩÊèêÁ§∫
        function checkFuJiuInfo() {
            if (typeof Solar === 'undefined') return;
            
            const daysInMonth = SolarUtil.getDaysOfMonth(state.currentYear, state.currentMonth);
            let hasFuJiu = false;
            
            for (let day = 1; day <= daysInMonth; day++) {
                try {
                    const solar = Solar.fromYmd(state.currentYear, state.currentMonth, day);
                    const lunar = solar.getLunar();
                    
                    // Ë∞ÉËØï‰ø°ÊÅØ
                    console.log(`${state.currentYear}-${state.currentMonth}-${day} ‰∏â‰πù‰ø°ÊÅØÊ£ÄÊü•:`);
                    
                    // Ê£ÄÊü•‰∏â‰ºè
                    if (lunar.getFu) {
                        const fu = lunar.getFu();
                        console.log('‰∏â‰ºè:', fu);
                        if (fu) {
                            hasFuJiu = true;
                            break;
                        }
                    }
                    
                    // Ê£ÄÊü•‰∏â‰πùÔºà‰ΩøÁî®Êñ∞ÁöÑgetShuJiuÊñπÊ≥ïÔºâ
                    if (lunar.getShuJiu) {
                        const shuJiu = lunar.getShuJiu();
                        console.log('Êï∞‰πùÂØπË±°:', shuJiu);
                        if (shuJiu) {
                            console.log('Êï∞‰πùÂêçÁß∞:', shuJiu.getName());
                            console.log('Êï∞‰πùÂ§©Êï∞:', shuJiu.getIndex());
                            hasFuJiu = true;
                            break;
                        }
                    }
                    
                    // ÂÖºÂÆπÊóßÁöÑ‰∏â‰πùÊñπÊ≥ï
                    if (lunar.getJiu) {
                        const jiu = lunar.getJiu();
                        console.log('‰∏â‰πù:', jiu);
                        if (jiu) {
                            hasFuJiu = true;
                            break;
                        }
                    }
                    
                    // Â∞ùËØïÂÖ∂‰ªñÂèØËÉΩÁöÑ‰∏â‰πù‰ø°ÊÅØËé∑ÂèñÊñπÊ≥ï
                    console.log('lunarÂØπË±°Â±ûÊÄß:', Object.keys(lunar));
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÊúâÂÖ∂‰ªñ‰∏â‰πùÁõ∏ÂÖ≥Â±ûÊÄß
                    if (lunar.fu) {
                        console.log('‰∏â‰ºè(Â±ûÊÄß):', lunar.fu);
                    }
                    if (lunar.jiu) {
                        console.log('‰∏â‰πù(Â±ûÊÄß):', lunar.jiu);
                    }
                    
                    // Ê£ÄÊü•ËäÇÊ∞î‰ø°ÊÅØÔºåÁúãÊòØÂê¶ÂåÖÂê´‰∏â‰πù
                    const jieQi = lunar.getJieQi();
                    console.log('ËäÇÊ∞î:', jieQi);
                    
                    // Ê£ÄÊü•ËäÇÊ∞îË°®
                    const jieQiTable = lunar.getJieQiTable ? lunar.getJieQiTable() : {};
                    console.log('ËäÇÊ∞îË°®:', jieQiTable);
                    
                    // ÊâãÂä®ËÆ°ÁÆó‰∏â‰πù‰ø°ÊÅØ
                    const manualJiuInfo = calculateManualJiuInfo(solar);
                    console.log('ÊâãÂä®ËÆ°ÁÆó‰∏â‰πù‰ø°ÊÅØ:', manualJiuInfo);
                    if (manualJiuInfo) {
                        hasFuJiu = true;
                        break;
                    }
                } catch (error) {
                    console.warn(`Ëé∑Âèñ${state.currentYear}Âπ¥${state.currentMonth}Êúà${day}Êó•‰ø°ÊÅØÂ§±Ë¥•:`, error);
                    continue;
                }
            }
            
            if (!hasFuJiu) {
                // Ê†πÊçÆÂΩìÂâçÊúà‰ªΩÁªôÂá∫Êô∫ËÉΩÊèêÁ§∫
                let message = '';
                const currentMonth = state.currentMonth;
                
                if (currentMonth >= 1 && currentMonth <= 2) {
                    message = 'ÂΩìÂâçÊòØÂÜ¨Â≠£Ôºå‰ΩÜÊú™Ê£ÄÊµãÂà∞‰∏â‰πù‰ø°ÊÅØ„ÄÇ\n‰∏â‰πùÈÄöÂ∏∏‰ªéÂÜ¨Ëá≥ÂêéÂºÄÂßãÔºåÂª∫ËÆÆÊ£ÄÊü•ÂΩìÂâçÂπ¥‰ªΩÁöÑÂÜ¨Ëá≥Êó•Êúü„ÄÇ';
                } else if (currentMonth >= 12) {
                    message = 'ÂΩìÂâçÊòØÂÜ¨Â≠£Ôºå‰ΩÜÊú™Ê£ÄÊµãÂà∞‰∏â‰πù‰ø°ÊÅØ„ÄÇ\n‰∏â‰πùÈÄöÂ∏∏‰ªéÂÜ¨Ëá≥ÂêéÂºÄÂßãÔºåÂª∫ËÆÆÊ£ÄÊü•ÂΩìÂâçÂπ¥‰ªΩÁöÑÂÜ¨Ëá≥Êó•Êúü„ÄÇ';
                } else if (currentMonth >= 6 && currentMonth <= 8) {
                    message = 'ÂΩìÂâçÊòØÂ§èÂ≠£ÔºåÂèØ‰ª•Êü•Áúã‰∏â‰ºè‰ø°ÊÅØ„ÄÇ\n‰∏â‰πù‰ø°ÊÅØÈÄöÂ∏∏Âú®ÂÜ¨Â≠£Ôºà12Êúà-2ÊúàÔºâÂá∫Áé∞„ÄÇ';
                } else {
                    message = 'ÂΩìÂâçÊúà‰ªΩ‰∏çÊòØ‰∏â‰πùÊàñ‰∏â‰ºèÁöÑÂ≠£ËäÇ„ÄÇ\n‰∏â‰πù‰ø°ÊÅØÈÄöÂ∏∏Âú®ÂÜ¨Â≠£Ôºà12Êúà-2ÊúàÔºâÂá∫Áé∞„ÄÇ';
                }
                
                // Ê£ÄÊü•ÂÜ¨Ëá≥Êó•Êúü
                try {
                    const dongzhi = Lunar.fromYmd(state.currentYear, 12, 1).getJieQiTable()['ÂÜ¨Ëá≥'];
                    if (dongzhi) {
                        // Â∞ùËØï‰∏çÂêåÁöÑËé∑ÂèñÊñπÂºè
                        let dongzhiDate;
                        if (typeof dongzhi.getSolar === 'function') {
                            dongzhiDate = dongzhi.getSolar();
                        } else if (dongzhi.toString) {
                            dongzhiDate = dongzhi.toString();
                        } else {
                            dongzhiDate = dongzhi;
                        }
                        message += `\n\n${state.currentYear}Âπ¥ÂÜ¨Ëá≥Ôºö${dongzhiDate}`;
                        message += '\nÊï∞‰πù‰ªéÂÜ¨Ëá≥ÂêéÂºÄÂßãÔºåÂÖ±81Â§©„ÄÇ';
                    }
                } catch (error) {
                    console.warn('Ëé∑ÂèñÂÜ¨Ëá≥‰ø°ÊÅØÂ§±Ë¥•:', error);
                }
                
                console.log('‰∏â‰πù‰ø°ÊÅØÊèêÁ§∫Ôºö', message);
                
                // Âú®È°µÈù¢Â∫ïÈÉ®ÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
                const infoDiv = document.createElement('div');
                infoDiv.className = 'fu-jiu-hint';
                infoDiv.innerHTML = `
                    <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 10px; margin: 10px 0; font-size: 12px; color: #856404;">
                        <strong>üìÖ ‰∏â‰πù‰ø°ÊÅØÊèêÁ§∫Ôºö</strong> ${message.replace(/\\n/g, '<br>')}
                        <br><button onclick="this.parentElement.parentElement.remove()" style="margin-left: 10px; background: #ffc107; border: none; padding: 2px 8px; border-radius: 3px; cursor: pointer;">ÂÖ≥Èó≠</button>
                    </div>
                `;
                
                const calendarDiv = document.getElementById('calendar');
                if (calendarDiv) {
                    calendarDiv.appendChild(infoDiv);
                }
            }
        }

        // ÊòæÁ§∫‰ªäÂ§©ÁöÑÈªÑÂéÜ‰ø°ÊÅØ
        function showToday() {
            const today = new Date();
            state.selectedDate = today;
            showDetail(today);
            
            // ÈÄâ‰∏≠‰ªäÂ§©ÁöÑÊó•Êúü
            setTimeout(() => {
                document.querySelectorAll('.calendar-day').forEach(el => {
                    el.classList.remove('selected');
                    if (el.classList.contains('today')) {
                        el.classList.add('selected');
                    }
                });
            }, 100);
        }

        // ÂàùÂßãÂåñÈÄâÊã©Âô®
        function initializeSelectors() {
            const yearInput = document.getElementById('yearInput');
            const monthSelect = document.getElementById('monthSelect');
            
            // ËÆæÁΩÆÂΩìÂâçÈÄâ‰∏≠ÁöÑÂπ¥Êúà
            if (yearInput) yearInput.value = state.currentYear;
            if (monthSelect) monthSelect.value = state.currentMonth;
            
            // Ê∑ªÂä†ÂõûËΩ¶ÈîÆÁõëÂê¨
            if (yearInput) {
                yearInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        updateCalendar();
                    }
                });
            }
        }

        // Ê∏≤ÊüìÊó•ÂéÜ
        function renderCalendar() {
            updateHeader();
            renderCalendarGrid();
        }

        // Êõ¥Êñ∞Â§¥ÈÉ®
        function updateHeader() {
            const yearInput = document.getElementById('yearInput');
            const monthSelect = document.getElementById('monthSelect');
            
            // ÂêåÊ≠•ÈÄâÊã©Âô®Áä∂ÊÄÅ
            if (yearInput) yearInput.value = state.currentYear;
            if (monthSelect) monthSelect.value = state.currentMonth;
        }

        // Êõ¥Êñ∞Êó•ÂéÜÔºà‰ªéÈÄâÊã©Âô®Ë∞ÉÁî®Ôºâ
        function updateCalendar() {
            const yearInput = document.getElementById('yearInput');
            const monthSelect = document.getElementById('monthSelect');
            
            if (yearInput && monthSelect) {
                const year = parseInt(yearInput.value);
                const month = parseInt(monthSelect.value);
                
                // È™åËØÅÂπ¥‰ªΩËåÉÂõ¥
                if (year && year >= 1900 && year <= 2100 && month >= 1 && month <= 12) {
                    state.currentYear = year;
                    state.currentMonth = month;
                    renderCalendar();
                    // Ê∏ÖÁ©∫ËØ¶ÊÉÖÈù¢Êùø
                    const detailPanel = document.getElementById('detailPanel');
                    if (detailPanel) {
                        detailPanel.innerHTML = '<div class="empty-state"><p>ËØ∑ÈÄâÊã©Êó•ÊúüÊü•ÁúãÈªÑÂéÜ‰ø°ÊÅØ</p></div>';
                    }
                } else {
                    // ÊÅ¢Â§çÊúâÊïàÂÄº
                    yearInput.value = state.currentYear;
                    monthSelect.value = state.currentMonth;
                }
            }
        }

        // Ê∏≤ÊüìÊó•ÂéÜÁΩëÊ†ºÔºà‰ΩøÁî®lunar.jsÂäüËÉΩÔºâ
        function renderCalendarGrid() {
            const grid = document.getElementById('calendarGrid');
            
            // Êõ¥Êñ∞ÊòüÊúüÊ†áÈ¢ò
            updateWeekdayHeaders(grid);

            // ‰ΩøÁî®lunar.jsËé∑ÂèñÂΩìÊúà‰ø°ÊÅØ
            let firstDay, lastDay, firstWeekDay, daysInMonth;
            
            if (typeof Solar !== 'undefined') {
                try {
                    // ‰ΩøÁî®Solar.fromYmdÂàõÂª∫ÂΩìÊúàÁ¨¨‰∏ÄÂ§©
                    firstDay = Solar.fromYmd(state.currentYear, state.currentMonth, 1);
                    // Ëé∑ÂèñÂΩìÊúàÂ§©Êï∞
                    daysInMonth = SolarUtil.getDaysOfMonth(state.currentYear, state.currentMonth);
                    // Ëé∑ÂèñÂΩìÊúàÊúÄÂêé‰∏ÄÂ§©
                    lastDay = Solar.fromYmd(state.currentYear, state.currentMonth, daysInMonth);
                    // Ëé∑ÂèñÁ¨¨‰∏ÄÂ§©ÊòØÊòüÊúüÂá†
                    firstWeekDay = firstDay.getWeek();
                } catch (error) {
                    console.warn('‰ΩøÁî®lunar.jsËé∑ÂèñÊúà‰ªΩ‰ø°ÊÅØÂ§±Ë¥•Ôºå‰ΩøÁî®ÂéüÁîüÊñπÊ≥ï:', error);
                    // ÈôçÁ∫ßÂà∞ÂéüÁîüÊñπÊ≥ï
                    firstDay = new Date(state.currentYear, state.currentMonth - 1, 1);
                    lastDay = new Date(state.currentYear, state.currentMonth, 0);
                    firstWeekDay = firstDay.getDay();
                    daysInMonth = lastDay.getDate();
                }
            } else {
                // Â¶ÇÊûúlunar.jsÊú™Âä†ËΩΩÔºå‰ΩøÁî®ÂéüÁîüÊñπÊ≥ï
                firstDay = new Date(state.currentYear, state.currentMonth - 1, 1);
                lastDay = new Date(state.currentYear, state.currentMonth, 0);
                firstWeekDay = firstDay.getDay();
                daysInMonth = lastDay.getDate();
            }

            // ËÆ°ÁÆóÈúÄË¶ÅÊ∑ªÂä†ÁöÑÁ©∫ÁôΩÊó•ÊúüÊï∞Èáè
            let emptyDaysCount;
            if (state.weekStart === 0) {
                // Âë®Êó•ÂºÄÂßã
                emptyDaysCount = firstWeekDay;
            } else {
                // Âë®‰∏ÄÂºÄÂßã
                emptyDaysCount = firstWeekDay === 0 ? 6 : firstWeekDay - 1;
            }

            // Ê∑ªÂä†‰∏ä‰∏™ÊúàÊú´ÁöÑÊó•Êúü
            const prevMonth = state.currentMonth === 1 ? 12 : state.currentMonth - 1;
            const prevMonthYear = state.currentMonth === 1 ? state.currentYear - 1 : state.currentYear;
            const prevMonthDays = SolarUtil ? SolarUtil.getDaysOfMonth(prevMonthYear, prevMonth) : new Date(prevMonthYear, prevMonth, 0).getDate();
            
            for (let i = emptyDaysCount - 1; i >= 0; i--) {
                const prevMonthDay = prevMonthDays - i;
                const dayElement = createCalendarDay(prevMonthDay, true); // trueË°®Á§∫ÊòØ‰∏ä‰∏™Êúà
                grid.appendChild(dayElement);
            }

            // Ê∑ªÂä†ÂΩìÊúàÊó•Êúü
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = createCalendarDay(day);
                grid.appendChild(dayElement);
            }

            // Ê∑ªÂä†‰∏ã‰∏™ÊúàÂàùÁöÑÊó•Êúü
            const totalCells = 7 * 6; // 6Ë°å7Âàó
            const remainingCells = totalCells - (emptyDaysCount + daysInMonth);
            // Á°Æ‰øù‰∏çË∂ÖËøáÂΩìÂâçÂë®ÁöÑÊúÄÂêé‰∏ÄÂ§©
            const daysToAdd = Math.min(remainingCells, 7 - ((emptyDaysCount + daysInMonth) % 7));
            for (let day = 1; day <= daysToAdd; day++) {
                const dayElement = createCalendarDay(day, false, true); // trueË°®Á§∫ÊòØ‰∏ã‰∏™Êúà
                grid.appendChild(dayElement);
            }
        }

        // Êõ¥Êñ∞ÊòüÊúüÊ†áÈ¢ò
        function updateWeekdayHeaders(grid) {
            // Ê∏ÖÁ©∫ÁΩëÊ†º
            grid.innerHTML = '';
            
            let weekdayHeaders;
            if (state.weekStart === 0) {
                // Âë®Êó•ÂºÄÂßãÔºöÊó•‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠
                weekdayHeaders = ['Êó•', '‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠'];
            } else {
                // Âë®‰∏ÄÂºÄÂßãÔºö‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠Êó•
                weekdayHeaders = ['‰∏Ä', '‰∫å', '‰∏â', 'Âõõ', '‰∫î', 'ÂÖ≠', 'Êó•'];
            }
            
            // Ê∑ªÂä†ÊòüÊúüÊ†áÈ¢ò
            weekdayHeaders.forEach(day => {
                const div = document.createElement('div');
                div.className = 'weekday';
                div.textContent = day;
                grid.appendChild(div);
            });
        }

        // ÂàõÂª∫Á©∫ÁôΩÊó•ÊúüÂÖÉÁ¥†
        function createEmptyDay() {
            const div = document.createElement('div');
            div.className = 'calendar-day other-month';
            return div;
        }



        // ËÆ°ÁÆóÊó•Êúü‰ø°ÊÅØ
        function calculateDateInfo(date) {
            try {
                // ‰ºòÂÖà‰ΩøÁî®lunar.jsÂÜÖÁΩÆÂáΩÊï∞
                let solar;
                let totalWeeks = 52; // ÈªòËÆ§ÂÄº
                let totalDays = 365; // ÈªòËÆ§ÂÄº
                
                if (typeof Solar !== 'undefined') {
                    try {
                        solar = Solar.fromDate(date);
                        // Ëé∑Âèñ‰∏ÄÂπ¥ÊÄªÂ§©Êï∞ÔºàËÄÉËôëÈó∞Âπ¥Ôºâ
                        totalDays = SolarUtil.getDaysOfYear(solar.getYear());
                        // ËÆ°ÁÆóÊÄªÂë®Êï∞ÔºàISOÂë®Ê†áÂáÜÔºâ- ‰ΩøÁî®ÂéüÁîüJavaScriptÂ§ÑÁêÜ
                        const lastDateOfYear = new Date(solar.getYear(), 11, 31);
                        totalWeeks = getWeekNumber(lastDateOfYear);
                    } catch (error) {
                        console.warn('‰ΩøÁî®lunar.jsËÆ°ÁÆóÊó•Êúü‰ø°ÊÅØÂ§±Ë¥•Ôºå‰ΩøÁî®ÂéüÁîüÊñπÊ≥ï:', error);
                    }
                }
                
                // ‰ΩøÁî®ÂéüÁîüJavaScriptËÆ°ÁÆóÊó•Êúü‰ø°ÊÅØ
                const year = date.getFullYear();
                const startOfYear = new Date(year, 0, 1);
                const endOfYear = new Date(year, 11, 31);
                
                // ËÆ°ÁÆó‰∏ÄÂπ¥‰∏≠ÁöÑÁ¨¨Âá†Â§©
                const dayOfYear = Math.floor((date - startOfYear) / (1000 * 60 * 60 * 24)) + 1;
                
                // ËÆ°ÁÆó‰∏ÄÂπ¥Ââ©‰ΩôÂ§©Êï∞
                const daysRemaining = Math.floor((endOfYear - date) / (1000 * 60 * 60 * 24));
                
                // ËÆ°ÁÆó‰∏ÄÂπ¥‰∏≠ÁöÑÁ¨¨Âá†Âë®ÔºàISOÂë®Ôºâ
                const weekOfYear = getWeekNumber(date);
                
                // ËÆ°ÁÆó‰∏ÄÂπ¥Ââ©‰ΩôÂë®Êï∞ÔºàÁ°Æ‰øù‰∏ç‰∏∫Ë¥üÊï∞Ôºâ
                const lastWeekOfYear = getWeekNumber(endOfYear);
                const weeksRemaining = Math.max(0, lastWeekOfYear - weekOfYear);
                
                // Êü•Êâæ‰∏ã‰∏Ä‰∏™ËäÇÊó•
                let nextFestival = findNextFestival(date);
                
                return {
                    dayOfYear,
                    daysRemaining,
                    weekOfYear,
                    weeksRemaining,
                    totalWeeks,
                    totalDays,
                    nextFestival
                };
            } catch (error) {
                console.warn('ËÆ°ÁÆóÊó•Êúü‰ø°ÊÅØÂ§±Ë¥•:', error);
                return {
                    dayOfYear: 0,
                    daysRemaining: 0,
                    weekOfYear: 0,
                    weeksRemaining: 0,
                    nextFestival: 'ÊöÇÊó†'
                };
            }
        }
        
        // Ëé∑ÂèñISOÂë®Êï∞
        function getWeekNumber(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            
            // Ëé∑ÂèñÂΩìÂπ¥ÁöÑÁ¨¨‰∏Ä‰∏™Âë®Âõõ
            const jan1 = new Date(d.getFullYear(), 0, 1);
            const firstThursday = new Date(jan1);
            firstThursday.setDate(jan1.getDate() + (11 - jan1.getDay()) % 7);
            
            // Ëé∑ÂèñÊó•ÊúüÊâÄÂú®Âë®ÁöÑÂë®Âõõ
            const weekThursday = new Date(d);
            weekThursday.setDate(d.getDate() + (11 - d.getDay()) % 7);
            
            // ËÆ°ÁÆóÂë®Êï∞
            const diffTime = weekThursday - firstThursday;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const weekNumber = Math.floor(diffDays / 7) + 1;
            
            // Â§ÑÁêÜË∑®Âπ¥ÊÉÖÂÜµ
            if (weekNumber === 0) {
                // Â±û‰∫é‰∏ä‰∏ÄÂπ¥ÁöÑÊúÄÂêé‰∏ÄÂë®
                return getWeekNumber(new Date(d.getFullYear() - 1, 11, 31));
            } else if (weekNumber === 53) {
                // Ê£ÄÊü•ÊòØÂê¶ÁúüÁöÑÊúâ53Âë®
                const dec31 = new Date(d.getFullYear(), 11, 31);
                const dec31Thursday = new Date(dec31);
                dec31Thursday.setDate(dec31.getDate() + (11 - dec31.getDay()) % 7);
                
                if (weekThursday.getTime() === dec31Thursday.getTime()) {
                    return 53;
                } else {
                    return 1; // Â±û‰∫é‰∏ã‰∏ÄÂπ¥Á¨¨‰∏ÄÂë®
                }
            }
            
            return weekNumber;
        }
        
        // Êü•Êâæ‰∏ã‰∏Ä‰∏™ËäÇÊó•
        function findNextFestival(date) {
            if (typeof Solar === 'undefined') {
                return 'ÊöÇÊó†';
            }
            
            try {
                const solar = Solar.fromDate(date);
                
                // Êü•ÊâæÊú™Êù•30Â§©ÂÜÖÁöÑËäÇÊó•
                for (let i = 1; i <= 30; i++) {
                    const futureSolar = solar.next(i);
                    const futureLunar = futureSolar.getLunar();
                    
                    const solarFestivals = futureSolar.getFestivals ? futureSolar.getFestivals() : [];
                    const lunarFestivals = futureLunar.getFestivals ? futureLunar.getFestivals() : [];
                    
                    if (solarFestivals.length > 0 || lunarFestivals.length > 0) {
                        const festival = solarFestivals[0] || lunarFestivals[0];
                        return `${festival} (${i}Â§©Âêé)`;
                    }
                }
                
                return 'ÊöÇÊó†';
            } catch (error) {
                return 'ÊöÇÊó†';
            }
        }

        // ÊòæÁ§∫Êó•ÊúüÊèêÁ§∫Ê°Ü
        function showDateTooltip(element, date) {
            const tooltip = document.getElementById('dateTooltip');
            if (!tooltip) {
                console.log('Êú™ÊâæÂà∞ÂºπÊ°ÜÂÖÉÁ¥†');
                return;
            }
            
            // Ê∑ªÂä†ÊòæÁ§∫Á±ª
            tooltip.classList.add('show');
            
            if (typeof Solar === 'undefined') {
                console.log('lunar.js Êú™Âä†ËΩΩ');
                return;
            }
            
            try {
                const solar = Solar.fromDate(date);
                const lunar = solar.getLunar ? solar.getLunar() : null;
                
                if (!lunar) return;
                
                // ‰ΩøÁî®Âõ∫ÂÆöÂè≥‰∏ãËßí‰ΩçÁΩÆÔºåÁßªÈô§Âä®ÊÄÅ‰ΩçÁΩÆËÆ°ÁÆó
                // ÂºπÊ°ÜÁé∞Âú®Âõ∫ÂÆöÂú®Âè≥‰∏ãËßíÔºå‰∏çÈúÄË¶ÅÂä®ÊÄÅ‰ΩçÁΩÆËÆ°ÁÆó
                tooltip.style.left = '';
                tooltip.style.top = '';
                
                // Êõ¥Êñ∞ÂÜÖÂÆπ
                // ÂÖ¨ÂéÜÊó•Êúü
                const weekDays = ['ÊòüÊúüÊó•', 'ÊòüÊúü‰∏Ä', 'ÊòüÊúü‰∫å', 'ÊòüÊúü‰∏â', 'ÊòüÊúüÂõõ', 'ÊòüÊúü‰∫î', 'ÊòüÊúüÂÖ≠'];
                const weekDay = weekDays[date.getDay()];
                document.getElementById('tooltipSolarDate').textContent = 
                    `${solar.getYear()}Âπ¥${solar.getMonth()}Êúà${solar.getDay()}Êó• ${weekDay}`;
                
                // ÂÜúÂéÜÊó•Êúü - Ê†ºÂºèÔºö‰πôÂ∑≥ËõáÂπ¥ ÂÜ¨ÊúàÔºàÂçÅÊúàÔºâÂàù‰πù
                let lunarText = '';
                
                // Ëé∑ÂèñÂπ¥‰ªΩÂπ≤ÊîØÂíåÁîüËÇñ
                const yearGanZhi = lunar.getYearInGanZhi ? lunar.getYearInGanZhi() : '';
                const yearShengXiao = lunar.getYearShengXiao ? lunar.getYearShengXiao() : '';
                
                // Ëé∑ÂèñÊúà‰ªΩ
                const monthInChinese = lunar.getMonthInChinese ? lunar.getMonthInChinese() : '';
                
                // Ëé∑ÂèñÂ§©Êï∞
                const dayInChinese = lunar.getDayInChinese ? lunar.getDayInChinese() : '';
                
                // ÊûÑÂª∫ÂÜúÂéÜÊòæÁ§∫Ê†ºÂºè
                if (yearGanZhi && yearShengXiao) {
                    lunarText = `${yearGanZhi}${yearShengXiao}Âπ¥ `;
                }
                
                if (monthInChinese) {
                    lunarText += monthInChinese + 'Êúà';
                }
                
                if (dayInChinese) {
                    lunarText += dayInChinese;
                }
                
                document.getElementById('tooltipLunarDate').textContent = lunarText;
                
                // ÊòæÁ§∫Êó•ÊúüËÆ°ÁÆó‰ø°ÊÅØ
                const dateInfo = calculateDateInfo(date);
                const dateInfoElement = document.getElementById('tooltipDateInfo');
                if (dateInfo) {
                    dateInfoElement.style.display = 'block';
                    document.getElementById('tooltipWeekOfYear').textContent = dateInfo.weekOfYear;
                    document.getElementById('tooltipWeeksRemaining').textContent = dateInfo.weeksRemaining;
                    document.getElementById('tooltipTotalWeeks').textContent = dateInfo.totalWeeks;
                    document.getElementById('tooltipDayOfYear').textContent = dateInfo.dayOfYear;
                    document.getElementById('tooltipDaysRemaining').textContent = dateInfo.daysRemaining;
                    document.getElementById('tooltipTotalDays').textContent = dateInfo.totalDays;
                    document.getElementById('tooltipNextFestival').textContent = dateInfo.nextFestival;
                } else {
                    dateInfoElement.style.display = 'none';
                }
                
                // Ê£ÄÊü•ËäÇÊ∞î
                const jieqi = lunar.getJieQi ? lunar.getJieQi() : null;
                const jieqiElement = document.getElementById('tooltipJieqi');
                if (jieqi && jieqiDesc[jieqi] && state.festivalSettings.showJieqi) {
                    jieqiElement.style.display = 'flex';
                    document.getElementById('tooltipJieqiName').textContent = jieqi;
                    document.getElementById('tooltipJieqiDesc').textContent = jieqiDesc[jieqi];
                    
                    // ËÆæÁΩÆËäÇÊ∞îÂõæÁâá
                    const imgElement = document.getElementById('tooltipJieqiImg');
                    const jieqiImagePath = getJieqiImagePath(jieqi);
                    if (jieqiImagePath) {
                        imgElement.src = jieqiImagePath;
                        imgElement.alt = jieqi;
                    } else {
                        // Â¶ÇÊûúÂõæÁâá‰∏çÂ≠òÂú®Ôºå‰ΩøÁî®ÈªòËÆ§ÂõæÁâá
                        imgElement.src = '';
                    }
                } else {
                    jieqiElement.style.display = 'none';
                }
                
                // Ê£ÄÊü•‰∏â‰ºè„ÄÅ‰∏â‰πù
                const fuJiuElement = document.getElementById('tooltipFuJiu');
                let hasFuJiu = false;
                let fuText = '';
                let jiuText = '';
                
                // Ê£ÄÊü•‰∏â‰ºè
                if (lunar.getFu) {
                    const fu = lunar.getFu();
                    if (fu) {
                        hasFuJiu = true;
                        fuText = fu;
                    }
                }
                
                // Ê£ÄÊü•‰∏â‰πùÔºà‰ΩøÁî®Êñ∞ÁöÑgetShuJiuÊñπÊ≥ïÔºâ
                if (lunar.getShuJiu) {
                    const shuJiu = lunar.getShuJiu();
                    if (shuJiu) {
                        hasFuJiu = true;
                        jiuText = shuJiu.getName() + 'Á¨¨' + shuJiu.getIndex() + 'Â§©';
                    }
                }
                
                // ÂÖºÂÆπÊóßÁöÑ‰∏â‰πùÊñπÊ≥ï
                if (lunar.getJiu) {
                    const jiu = lunar.getJiu();
                    if (jiu) {
                        hasFuJiu = true;
                        jiuText = jiu;
                    }
                }
                
                // Âè™ÊúâÂΩìÊúâËäÇÊ∞îËÆæÁΩÆ‰∏îÁ°ÆÂÆûÊúâ‰∏â‰ºè‰∏â‰πù‰ø°ÊÅØÊó∂ÊâçÊòæÁ§∫
                if (state.festivalSettings.showJieqi && hasFuJiu) {
                    fuJiuElement.style.display = 'block';
                    
                    // ËÆæÁΩÆ‰∏â‰ºè‰ø°ÊÅØÔºåÂ¶ÇÊûúÊ≤°Êúâ‰∏â‰ºèÂàôÊ∏ÖÁ©∫
                    document.getElementById('tooltipFu').textContent = fuText || '';
                    document.getElementById('tooltipJiu').textContent = jiuText || '';
                    
                    // Â¶ÇÊûúÂÖ∂‰∏≠‰∏Ä‰∏™Ê≤°ÊúâÂÜÖÂÆπÔºåÈöêËóèÂØπÂ∫îÁöÑdiv
                    const tooltipFu = document.getElementById('tooltipFu');
                    const tooltipJiu = document.getElementById('tooltipJiu');
                    
                    if (!fuText) {
                        tooltipFu.style.display = 'none';
                    } else {
                        tooltipFu.style.display = 'block';
                    }
                    
                    if (!jiuText) {
                        tooltipJiu.style.display = 'none';
                    } else {
                        tooltipJiu.style.display = 'block';
                    }
                    
                    // Â¶ÇÊûú‰∏§ËÄÖÈÉΩÊ≤°ÊúâÂÜÖÂÆπÔºåÈöêËóèÊï¥‰∏™‰º†ÁªüËäÇÊ∞îÈÉ®ÂàÜ
                    if (!fuText && !jiuText) {
                        fuJiuElement.style.display = 'none';
                    }
                } else {
                    fuJiuElement.style.display = 'none';
                }
                
                // Ê£ÄÊü•ËäÇÂÅáÊó•
                const holidayElement = document.getElementById('tooltipHoliday');
                if (typeof HolidayUtil !== 'undefined') {
                    const holidayInfo = HolidayUtil.getHoliday(solar.getYear(), solar.getMonth(), solar.getDay());
                    if (holidayInfo) {
                        holidayElement.style.display = 'block';
                        holidayElement.className = `tooltip-holiday ${holidayInfo.isWork() ? 'work' : 'rest'}`;
                        document.getElementById('tooltipHolidaySymbol').textContent = holidayInfo.isWork() ? 'Áè≠' : '‰ºë';
                        document.getElementById('tooltipHolidayName').textContent = holidayInfo.getName();
                    } else {
                        holidayElement.style.display = 'none';
                    }
                } else {
                    holidayElement.style.display = 'none';
                }
                
                // Ê£ÄÊü•ËäÇÊó•
                const festivalsElement = document.getElementById('tooltipFestivals');
                const festivalListElement = document.getElementById('tooltipFestivalList');
                festivalListElement.innerHTML = '';
                
                let allFestivals = [];

                // ÊèêÁ§∫Ê°ÜÂßãÁªàÊòæÁ§∫ÊâÄÊúâËäÇÊó•Ôºå‰∏çÂèóËÆæÁΩÆÈôêÂà∂
                const solarFestivals = solar.getFestivals ? solar.getFestivals() : [];
                allFestivals = allFestivals.concat(solarFestivals);

                const lunarFestivals = lunar.getFestivals ? lunar.getFestivals() : [];
                allFestivals = allFestivals.concat(lunarFestivals);

                const otherFestivals = solar.getOtherFestivals ? solar.getOtherFestivals() : [];
                allFestivals = allFestivals.concat(otherFestivals);

                // Ëé∑ÂèñÊòüÊúüËäÇÊó•
                if (typeof SolarUtil !== 'undefined' && SolarUtil.WEEK_FESTIVAL) {
                    const week = solar.getWeek();
                    const weekInMonth = Math.ceil(solar.getDay() / 7);
                    const weekKey1 = solar.getMonth() + '-' + weekInMonth + '-' + week;
                    const weekKey2 = solar.getMonth() + '-0-' + week;
                    
                    const addedFestivals = new Set(allFestivals);
                    
                    if (SolarUtil.WEEK_FESTIVAL[weekKey1]) {
                        const festival = SolarUtil.WEEK_FESTIVAL[weekKey1];
                        if (!addedFestivals.has(festival)) {
                            allFestivals.push(festival);
                        }
                    }
                    if (SolarUtil.WEEK_FESTIVAL[weekKey2]) {
                        const festival = SolarUtil.WEEK_FESTIVAL[weekKey2];
                        if (!addedFestivals.has(festival)) {
                            allFestivals.push(festival);
                        }
                    }
                }
                
                // ÊòæÁ§∫ËäÇÊó•ÂàóË°®
                if (allFestivals.length > 0) {
                    festivalsElement.style.display = 'block';
                    allFestivals.forEach(festival => {
                        const festivalItem = document.createElement('div');
                        festivalItem.className = 'tooltip-festival-item';
                        festivalItem.textContent = festival;
                        festivalListElement.appendChild(festivalItem);
                    });
                } else {
                    festivalsElement.style.display = 'none';
                }
                
                // ÊòæÁ§∫ÊèêÁ§∫Ê°Ü
                tooltip.classList.add('show');
                
            } catch (error) {
                console.warn('ÊòæÁ§∫Êó•ÊúüÊèêÁ§∫Ê°ÜÂ§±Ë¥•:', error);
            }
        }

        // ÈöêËóèÊó•ÊúüÊèêÁ§∫Ê°Ü
        function hideDateTooltip() {
            const tooltip = document.getElementById('dateTooltip');
            if (tooltip) {
                tooltip.classList.remove('show');
            }
        }

        // Â§çÂà∂ÊèêÁ§∫Ê°ÜÂÖ®ÈÉ®ÂÜÖÂÆπ
        function copyTooltipContent() {
            console.log('Â§çÂà∂ÊåâÈíÆË¢´ÁÇπÂáª');

            const tooltip = document.getElementById('dateTooltip');
            if (!tooltip) {
                console.log('Êâæ‰∏çÂà∞ÊèêÁ§∫Ê°ÜÂÖÉÁ¥†');
                return;
            }

            // ÊèêÂèñÊ†ºÂºèÂåñÁöÑÊñáÊú¨ÂÜÖÂÆπ
            const content = formatTooltipContent();
            console.log('Â§çÂà∂ÁöÑÂÜÖÂÆπ:', content);

            if (!content.trim()) {
                showToast('Ê≤°ÊúâÂèØÂ§çÂà∂ÁöÑÂÜÖÂÆπ');
                return;
            }

            console.log('ÂºÄÂßãÂ§çÂà∂...');

            // ‰ºòÂÖà‰ΩøÁî®‰º†ÁªüÊñπÊ≥ïÔºåÂú®ÁßªÂä®Á´ØÊõ¥ÂèØÈù†
            const textarea = document.createElement('textarea');
            textarea.value = content;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            textarea.style.top = '0';
            textarea.style.left = '0';
            textarea.style.width = '1px';
            textarea.style.height = '1px';
            textarea.style.border = 'none';
            textarea.style.outline = 'none';
            textarea.style.boxShadow = 'none';
            textarea.style.background = 'transparent';
            textarea.style.padding = '0';
            textarea.style.margin = '0';
            textarea.readOnly = true; // ÊèêÂçáÁßªÂä®Á´ØÂÖºÂÆπÊÄß
            document.body.appendChild(textarea);

            // Âú®iOS‰∏äÈúÄË¶ÅÁâπÊÆäÂ§ÑÁêÜ
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

            if (isIOS) {
                // iOS ‰ΩøÁî® range ÈÄâÊã©ÊñπÂºè
                const range = document.createRange();
                range.selectNodeContents(textarea);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                textarea.setSelectionRange(0, 999999);
            } else {
                // ÂÖ∂‰ªñËÆæÂ§á‰ΩøÁî®‰º†ÁªüÊñπÂºè
                textarea.select();
                textarea.setSelectionRange(0, 999999);
            }

            try {
                // ‰ºòÂÖàÂ∞ùËØïÁé∞‰ª£ API
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(content).then(() => {
                        console.log('Clipboard API Â§çÂà∂ÊàêÂäü');
                        showToast('Â∑≤Â§çÂà∂ÂÖ®ÈÉ®ÂÜÖÂÆπ');
                    }).catch(err => {
                        console.warn('Clipboard API Â§±Ë¥•ÔºåÂ∞ùËØïÈôçÁ∫ßÊñπÊ°à:', err);
                        // ÈôçÁ∫ßÂà∞ execCommand
                        const success = document.execCommand('copy');
                        console.log('ÈôçÁ∫ßÂ§çÂà∂ÁªìÊûú:', success);
                        if (success) {
                            showToast('Â∑≤Â§çÂà∂ÂÖ®ÈÉ®ÂÜÖÂÆπ');
                        } else {
                            showToast('Â§çÂà∂Â§±Ë¥•');
                        }
                    });
                } else {
                    // Áõ¥Êé•‰ΩøÁî® execCommand
                    const success = document.execCommand('copy');
                    console.log('execCommand Â§çÂà∂ÁªìÊûú:', success);
                    if (success) {
                        showToast('Â∑≤Â§çÂà∂ÂÖ®ÈÉ®ÂÜÖÂÆπ');
                    } else {
                        showToast('Â§çÂà∂Â§±Ë¥•');
                    }
                }
            } catch (e) {
                console.error('Â§çÂà∂Â§±Ë¥•:', e);
                showToast('Â§çÂà∂Â§±Ë¥•');
            }

            // Âª∂ËøüÁßªÈô§ textareaÔºåÁ°Æ‰øùÂ§çÂà∂Êìç‰ΩúÂÆåÊàê
            setTimeout(() => {
                document.body.removeChild(textarea);
            }, 100);
        }

        // Ê†ºÂºèÂåñÊèêÁ§∫Ê°ÜÂÜÖÂÆπ‰∏∫„ÄêÊ†áÈ¢ò„Äë‰ø°ÊÅØÊ†ºÂºè
        function formatTooltipContent() {
            const tooltip = document.getElementById('dateTooltip');
            if (!tooltip) return '';

            let content = '';

            // Ëé∑ÂèñÈò≥ÂéÜÊó•Êúü
            const solarDate = document.getElementById('tooltipSolarDate');
            if (solarDate && solarDate.textContent.trim()) {
                content += `„ÄêÂÖ¨ÂéÜ„Äë${solarDate.textContent.trim()}\n`;
            }

            // Ëé∑ÂèñÂÜúÂéÜÊó•Êúü
            const lunarDate = document.getElementById('tooltipLunarDate');
            if (lunarDate && lunarDate.textContent.trim()) {
                content += `„ÄêÂÜúÂéÜ„Äë${lunarDate.textContent.trim()}\n`;
            }

            // Ëé∑ÂèñÊó•ÊúüËÆ°ÁÆó‰ø°ÊÅØ
            const dateInfo = document.getElementById('tooltipDateInfo');
            if (dateInfo && dateInfo.style.display !== 'none') {
                const weekOfYear = document.getElementById('tooltipWeekOfYear');
                const weeksRemaining = document.getElementById('tooltipWeeksRemaining');
                const totalWeeks = document.getElementById('tooltipTotalWeeks');
                const dayOfYear = document.getElementById('tooltipDayOfYear');
                const daysRemaining = document.getElementById('tooltipDaysRemaining');
                const totalDays = document.getElementById('tooltipTotalDays');
                const nextFestival = document.getElementById('tooltipNextFestival');

                if (weekOfYear && weekOfYear.textContent.trim()) {
                    content += `„ÄêÂë®Êï∞„ÄëÁ¨¨${weekOfYear.textContent.trim()}Âë®/Ââ©${weeksRemaining.textContent.trim()}Âë®ÔºàÂÖ±${totalWeeks.textContent.trim()}Âë®Ôºâ\n`;
                }
                if (dayOfYear && dayOfYear.textContent.trim()) {
                    content += `„ÄêÂ§©Êï∞„ÄëÁ¨¨${dayOfYear.textContent.trim()}Â§©/Ââ©${daysRemaining.textContent.trim()}Â§©ÔºàÂÖ±${totalDays.textContent.trim()}Â§©Ôºâ\n`;
                }
                if (nextFestival && nextFestival.textContent.trim()) {
                    content += `„Äê‰∏ã‰∏™ËäÇÊó•„Äë${nextFestival.textContent.trim()}\n`;
                }
            }

            // Ëé∑ÂèñËäÇÊ∞î‰ø°ÊÅØ
            const jieqi = document.getElementById('tooltipJieqi');
            if (jieqi && jieqi.style.display !== 'none') {
                const jieqiName = document.getElementById('tooltipJieqiName');
                const jieqiDesc = document.getElementById('tooltipJieqiDesc');
                if (jieqiName && jieqiName.textContent.trim()) {
                    content += `„ÄêËäÇÊ∞î„Äë${jieqiName.textContent.trim()}`;
                    if (jieqiDesc && jieqiDesc.textContent.trim()) {
                        content += ` - ${jieqiDesc.textContent.trim()}`;
                    }
                    content += '\n';
                }
            }

            // Ëé∑Âèñ‰∏â‰ºè‰∏â‰πù‰ø°ÊÅØ
            const fuJiu = document.getElementById('tooltipFuJiu');
            if (fuJiu && fuJiu.style.display !== 'none') {
                const fu = document.getElementById('tooltipFu');
                const jiu = document.getElementById('tooltipJiu');
                if (fu && fu.textContent.trim()) {
                    content += `„Äê‰∏â‰ºè„Äë${fu.textContent.trim()}\n`;
                }
                if (jiu && jiu.textContent.trim()) {
                    content += `„Äê‰∏â‰πù„Äë${jiu.textContent.trim()}\n`;
                }
            }

            // Ëé∑ÂèñËäÇÂÅáÊó•‰ø°ÊÅØ
            const holiday = document.getElementById('tooltipHoliday');
            if (holiday && holiday.style.display !== 'none') {
                const holidayName = document.getElementById('tooltipHolidayName');
                if (holidayName && holidayName.textContent.trim()) {
                    content += `„ÄêËäÇÂÅáÊó•„Äë${holidayName.textContent.trim()}\n`;
                }
            }

            // Ëé∑ÂèñËäÇÊó•ÂàóË°®
            const festivals = document.getElementById('tooltipFestivals');
            if (festivals && festivals.style.display !== 'none') {
                const festivalList = document.getElementById('tooltipFestivalList');
                if (festivalList && festivalList.textContent.trim()) {
                    const festivalItems = festivalList.querySelectorAll('.tooltip-festival-item');
                    if (festivalItems.length > 0) {
                        content += '„ÄêËäÇÊó•„Äë';
                        const festivalNames = Array.from(festivalItems).map(item => item.textContent.trim()).join('„ÄÅ');
                        content += festivalNames + '\n';
                    } else {
                        content += `„ÄêËäÇÊó•„Äë${festivalList.textContent.trim()}\n`;
                    }
                }
            }

            return content.trim();
        }



        // ÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØ
        function showToast(message) {
            console.log('ÊòæÁ§∫ÊèêÁ§∫:', message);

            // ÁßªÈô§Â∑≤Â≠òÂú®ÁöÑÊèêÁ§∫
            const existingToast = document.querySelector('.toast-message');
            if (existingToast) {
                existingToast.remove();
            }

            const toast = document.createElement('div');
            toast.className = 'toast-message';
            toast.textContent = message;
            toast.style.position = 'fixed';
            toast.style.top = '20px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.background = 'rgba(0, 0, 0, 0.8)';
            toast.style.color = 'white';
            toast.style.padding = '12px 24px';
            toast.style.borderRadius = '8px';
            toast.style.fontSize = '14px';
            toast.style.zIndex = '99999';
            toast.style.animation = 'toastFade 0.3s ease';

            document.body.appendChild(toast);
            console.log('ÊèêÁ§∫Â∑≤Ê∑ªÂä†Âà∞DOM');

            setTimeout(() => {
                console.log('ÂáÜÂ§áÁßªÈô§ÊèêÁ§∫');
                toast.style.animation = 'toastFade 0.3s ease reverse';
                setTimeout(() => {
                    console.log('ÁßªÈô§ÊèêÁ§∫');
                    toast.remove();
                }, 3000);
            }, 2000);
        }

        // ÂàõÂª∫Êó•ÂéÜÊó•ÊúüÂÖÉÁ¥†
        function createCalendarDay(day, isPrevMonth = false, isNextMonth = false) {
            const div = document.createElement('div');
            
            // ËÆæÁΩÆÊó•ÊúüÁ±ªÂêç
            if (isPrevMonth || isNextMonth) {
                div.className = 'calendar-day other-month';
            } else {
                div.className = 'calendar-day';
            }

            // ËÆ°ÁÆóÂÆûÈôÖÊó•Êúü
            let date;
            if (isPrevMonth) {
                // ‰∏ä‰∏™ÊúàÊú´ÁöÑÊó•Êúü
                date = new Date(state.currentYear, state.currentMonth - 2, day);
            } else if (isNextMonth) {
                // ‰∏ã‰∏™ÊúàÂàùÁöÑÊó•Êúü
                date = new Date(state.currentYear, state.currentMonth, day);
            } else {
                // ÂΩìÂâçÊúàÁöÑÊó•Êúü
                date = new Date(state.currentYear, state.currentMonth - 1, day);
            }
            
            // Ê∑ªÂä†Êó•ÊúüÊ†áËØÜÂ±ûÊÄß
            div.setAttribute('data-date', date.toDateString());
            
            div.onclick = () => selectDate(date);

            // Ê∑ªÂä†Èº†Ê†áÊÇ¨ÂÅú‰∫ã‰ª∂
            let hoverTimer;
            div.addEventListener('mouseenter', () => {
                hoverTimer = setTimeout(() => {
                    showDateTooltip(div, date);
                }, 500); // 0.5ÁßíÂêéÊòæÁ§∫ÊèêÁ§∫Ê°Ü
            });
            
            div.addEventListener('mouseleave', () => {
                clearTimeout(hoverTimer);
                // ÁßªÈô§Ëá™Âä®ÈöêËóèÂäüËÉΩÔºåÊèêÁ§∫Ê°ÜÂ∞Ü‰øùÊåÅÊòæÁ§∫Áõ¥Âà∞Áî®Êà∑ÁÇπÂáªÂÖ∂‰ªñÂú∞Êñπ
            });
            
            // Âà§Êñ≠ÊòØÂê¶‰∏∫Âë®Êú´
            const dayOfWeek = date.getDay();
            if ((state.weekStart === 0 && (dayOfWeek === 0 || dayOfWeek === 6)) || // Âë®Êó•ÂºÄÂßãÔºöÂë®Êó•=0ÔºåÂë®ÂÖ≠=6
                (state.weekStart === 1 && (dayOfWeek === 6 || dayOfWeek === 0))) { // Âë®‰∏ÄÂºÄÂßãÔºöÂë®ÂÖ≠=6ÔºåÂë®Êó•=0
                div.classList.add('weekend');
            }
            
            // Êó•ÊúüÊï∞Â≠ó
            const dayNumber = document.createElement('div');
            dayNumber.className = 'day-number';
            dayNumber.textContent = day;
            
            // Â¶ÇÊûúÊòØÈùûÂΩìÂâçÊúàÁöÑÊó•ÊúüÔºåÊ∑ªÂä†ÈÄèÊòéÂ∫¶ÊïàÊûú
            if (isPrevMonth || isNextMonth) {
                dayNumber.style.opacity = '0.5';
            }
            
            div.appendChild(dayNumber);

            // Â¶ÇÊûúlunar.jsÊú™Âä†ËΩΩÔºåÂè™ÊòæÁ§∫ÂÖ¨ÂéÜÊó•Êúü
            if (typeof Solar === 'undefined') {
                return div;
            }
            
            try {
                const solar = Solar.fromDate(date);
                const lunar = solar.getLunar ? solar.getLunar() : null;

                if (lunar) {
                    // ÂÜúÂéÜÊó•Êúü
                    const lunarDay = document.createElement('div');
                    lunarDay.className = 'lunar-day';
                    
                    // Â¶ÇÊûúÊòØÈùûÂΩìÂâçÊúàÁöÑÊó•ÊúüÔºåÂÜúÂéÜÊó•Êúü‰πüÊ∑ªÂä†ÈÄèÊòéÂ∫¶
                    if (isPrevMonth || isNextMonth) {
                        lunarDay.style.opacity = '0.5';
                    }
                    
                    lunarDay.textContent = lunar.getDayInChinese ? lunar.getDayInChinese() : '';
                    div.appendChild(lunarDay);

                    // Ê£ÄÊü•ËäÇÊó•
                    checkAndAddFestival(div, solar, lunar);
                }
            } catch (error) {
                console.warn('Ëé∑ÂèñÂÜúÂéÜ‰ø°ÊÅØÂ§±Ë¥•:', error);
            }

            // Ê£ÄÊü•ÊòØÂê¶‰ªäÂ§©
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                div.classList.add('today');
            }

            // Ê£ÄÊü•ÈÄâ‰∏≠Áä∂ÊÄÅ
            if (state.selectedDate && 
                date.toDateString() === state.selectedDate.toDateString()) {
                div.classList.add('selected');
            }

            return div;
        }



        // Ê£ÄÊü•Âπ∂Ê∑ªÂä†ËäÇÊó•Ê†áËÆ∞
        function checkAndAddFestival(div, solar, lunar) {
            let hasTag = false;

            // Ê£ÄÊü•ËäÇÊ∞î
            const jieqi = lunar.getJieQi ? lunar.getJieQi() : null;
            // Ê£ÄÊü•ËäÇÊ∞îÊòØÂê¶ÊúâÊïàÔºà‰∏ç‰∏∫Á©∫‰∏î‰∏çÊòØnull/undefinedÔºâ
            if (jieqi && jieqi.trim() !== '' && state.festivalSettings.showJieqi) {
                const tag = document.createElement('div');
                tag.className = 'jieqi-tag';
                // getJieQi() Áõ¥Êé•ËøîÂõûËäÇÊ∞îÂêçÁß∞Â≠óÁ¨¶‰∏≤
                tag.textContent = jieqi;
                tag.title = jieqi; // Èº†Ê†áÊÇ¨ÂÅúÊòæÁ§∫ÂÆåÊï¥ËäÇÊ∞îÂêçÁß∞
                tag.style.background = jieqiData[jieqi] || '#4ECDC4';
                div.appendChild(tag);
                hasTag = true;
            }

            // Ê£ÄÊü•‰∏â‰ºè„ÄÅ‰∏â‰πùÁ≠âÁâπÊÆäËäÇÊ∞î
            if (state.festivalSettings.showJieqi) {
                // Ê£ÄÊü•‰∏â‰ºè
                if (lunar.getFu) {
                    const fu = lunar.getFu();
                    if (fu) {
                        const fuTag = document.createElement('div');
                        fuTag.className = 'fu-jiu-tag';
                        fuTag.textContent = fu;
                        fuTag.title = fu;
                        div.appendChild(fuTag);
                        hasTag = true;
                    }
                }
                
                // Ê£ÄÊü•‰∏â‰πùÔºà‰ΩøÁî®Êñ∞ÁöÑgetShuJiuÊñπÊ≥ïÔºâ
                if (lunar.getShuJiu) {
                    const shuJiu = lunar.getShuJiu();
                    if (shuJiu) {
                        const jiuTag = document.createElement('div');
                        jiuTag.className = 'fu-jiu-tag';
                        jiuTag.textContent = shuJiu.getName();
                        jiuTag.title = shuJiu.getName() + 'Á¨¨' + shuJiu.getIndex() + 'Â§©';
                        div.appendChild(jiuTag);
                        hasTag = true;
                    }
                }
                
                // ÂÖºÂÆπÊóßÁöÑ‰∏â‰πùÊñπÊ≥ï
                if (lunar.getJiu) {
                    const jiu = lunar.getJiu();
                    if (jiu) {
                        const jiuTag = document.createElement('div');
                        jiuTag.className = 'fu-jiu-tag';
                        jiuTag.textContent = jiu;
                        jiuTag.title = jiu;
                        div.appendChild(jiuTag);
                        hasTag = true;
                    }
                }
                
                // ÁßªÈô§‰∫ÜÊâãÂä®ËÆ°ÁÆóÈÉ®ÂàÜÔºåÂè™ÊúâÂΩìlunar.jsËøîÂõûÁúüÂÆûÁöÑ‰∏â‰πù‰ø°ÊÅØÊó∂ÊâçÊòæÁ§∫Ê†áÁ≠æ
            }

            // Ê£ÄÊü•ËäÇÂÅáÊó•
            let holidayInfo = null;
            if (typeof HolidayUtil !== 'undefined') {
                holidayInfo = HolidayUtil.getHoliday(solar.getYear(), solar.getMonth(), solar.getDay());
            }
            
            // Ê£ÄÊü•ÊôÆÈÄöËäÇÊó•
            const solarFestivals = solar.getFestivals ? solar.getFestivals() : [];
            const lunarFestivals = lunar.getFestivals ? lunar.getFestivals() : [];
            const otherFestivals = solar.getOtherFestivals ? solar.getOtherFestivals() : [];

            // Ë∞ÉËØï‰ø°ÊÅØ
            if (solar.getMonth() === 0 && (solar.getDay() === 8 || solar.getDay() === 10)) {
                console.log('Ë∞ÉËØï‰ø°ÊÅØ:', {
                    solarDate: `${solar.getYear()}-${solar.getMonth() + 1}-${solar.getDay()}`,
                    solarFestivals,
                    lunarFestivals,
                    otherFestivals,
                    showOtherFestivals: state.festivalSettings.showOtherFestivals
                });
            }
            
            // Ëé∑ÂèñÊòüÊúüËäÇÊó•
            let weekFestivals = [];
            if (typeof SolarUtil !== 'undefined' && SolarUtil.WEEK_FESTIVAL && state.festivalSettings.showWeekFestivals) {
                const week = solar.getWeek();
                const weekInMonth = Math.ceil(solar.getDay() / 7);
                const weekKey1 = solar.getMonth() + '-' + weekInMonth + '-' + week;
                const weekKey2 = solar.getMonth() + '-0-' + week;
                
                // ‰ΩøÁî®SetÊù•ÈÅøÂÖçÈáçÂ§çÊ∑ªÂä†Âêå‰∏Ä‰∏™ËäÇÊó•
                const addedFestivals = new Set();
                
                if (SolarUtil.WEEK_FESTIVAL[weekKey1]) {
                    const festival = SolarUtil.WEEK_FESTIVAL[weekKey1];
                    if (!addedFestivals.has(festival)) {
                        weekFestivals.push(festival);
                        addedFestivals.add(festival);
                    }
                }
                if (SolarUtil.WEEK_FESTIVAL[weekKey2]) {
                    const festival = SolarUtil.WEEK_FESTIVAL[weekKey2];
                    if (!addedFestivals.has(festival)) {
                        weekFestivals.push(festival);
                        addedFestivals.add(festival);
                    }
                }
            }
            
            let festivals = [];
            
            // ‰ΩøÁî®SetÊù•ÈÅøÂÖçÊâÄÊúâÁ±ªÂûãÁöÑÈáçÂ§çËäÇÊó•
            const addedFestivals = new Set();
            
            // Ê†πÊçÆËÆæÁΩÆÁ≠õÈÄâËäÇÊó•Á±ªÂûã
            if (state.festivalSettings.showSolarFestivals) {
                solarFestivals.forEach(festival => {
                    if (!addedFestivals.has(festival)) {
                        festivals.push(festival);
                        addedFestivals.add(festival);
                    }
                });
            }
            if (state.festivalSettings.showLunarFestivals) {
                lunarFestivals.forEach(festival => {
                    if (!addedFestivals.has(festival)) {
                        festivals.push(festival);
                        addedFestivals.add(festival);
                    }
                });
            }
            if (state.festivalSettings.showOtherFestivals) {
                otherFestivals.forEach(festival => {
                    if (!addedFestivals.has(festival)) {
                        festivals.push(festival);
                        addedFestivals.add(festival);
                    }
                });
            }
            // ÊòüÊúüËäÇÊó•Â∑≤ÁªèÂ§ÑÁêÜËøáÈáçÂ§çÔºå‰ΩÜËøôÈáå‰πüË¶ÅÊ£ÄÊü•
            weekFestivals.forEach(festival => {
                if (!addedFestivals.has(festival)) {
                    festivals.push(festival);
                    addedFestivals.add(festival);
                }
            });
            
            // Â¶ÇÊûúÊúâËäÇÂÅáÊó•ÔºåÂú®Âè≥‰∏äËßíÊòæÁ§∫"‰ºë"Êàñ"Áè≠"
            if (holidayInfo) {
                const holidayTag = document.createElement('div');
                holidayTag.className = 'holiday-tag';
                
                // ÁÆÄÂåñÊòæÁ§∫Ôºö‰ºëÊÅØÊó•ÊòæÁ§∫"‰ºë"ÔºåË∞É‰ºëÊó•ÊòæÁ§∫"Áè≠"
                if (holidayInfo.isWork()) {
                    holidayTag.textContent = 'Áè≠';
                    holidayTag.style.background = '#E6A23C'; // Ë∞É‰ºëÊó• - Ê©ôËâ≤
                } else {
                    holidayTag.textContent = '‰ºë';
                    holidayTag.style.background = '#5CB85C'; // ‰ºëÊÅØÊó• - ÁªøËâ≤
                }
                
                // Ê∑ªÂä†ËäÇÂÅáÊó•ÂêçÁß∞‰Ωú‰∏∫ÊèêÁ§∫
                holidayTag.title = holidayInfo.getName();
                
                div.appendChild(holidayTag);
                hasTag = true;
            }
            
            // Â¶ÇÊûúÊúâÊôÆÈÄöËäÇÊó•ÔºåÂú®È°∂ÈÉ®‰∏≠Èó¥ÊòæÁ§∫ËäÇÊó•ÂêçÁß∞
            if (festivals.length > 0) {
                // Ëé∑ÂèñÊâÄÊúâËäÇÊó•ÂêçÁß∞Áî®‰∫étooltip
                const allFestivalNames = festivals.join('„ÄÅ');

                // ‰∏∫ÊØè‰∏™ËäÇÊó•ÂàõÂª∫ÂçïÁã¨ÁöÑÊ†áÁ≠æ
                festivals.forEach((festivalName, index) => {
                    const festivalTag = document.createElement('div');
                    festivalTag.className = 'festival-tag';

                    // ÊòæÁ§∫Á¨¨‰∏Ä‰∏™ËäÇÊó•Ê†áÁ≠æÂú®È°∂ÈÉ®ÔºåÂÖ∂‰ªñÁöÑÁ®çÂæÆÂÅèÁßª
                    if (index === 0) {
                        festivalTag.style.top = '2px';
                    } else {
                        festivalTag.style.top = (2 + index * 12) + 'px';
                    }

                    // ÁÆÄÂåñÊòæÁ§∫ÂêçÁß∞
                    let displayName = festivalName;
                    if (festivalName.length > 3) {
                        // ÁÆÄÂåñËäÇÊó•ÂêçÁß∞ÊòæÁ§∫
                        if (festivalName.includes('ËäÇ')) {
                            displayName = festivalName.replace('ËäÇ', '');
                        }
                        if (displayName.length > 3) {
                            displayName = displayName.substring(0, 3);
                        }
                    }

                    festivalTag.textContent = displayName;
                    festivalTag.title = festivalName; // Èº†Ê†áÊÇ¨ÂÅúÊòæÁ§∫ÂÆåÊï¥ÂêçÁß∞
                    festivalTag.style.background = '#FF6B6B'; // ÊôÆÈÄöËäÇÊó• - Á∫¢Ëâ≤

                    div.appendChild(festivalTag);
                    hasTag = true;
                });

                // Â¶ÇÊûúÊúâÂ§ö‰∏™ËäÇÊó•ÔºåÊ∑ªÂä†‰∏Ä‰∏™ÊòæÁ§∫ÂÖ®ÈÉ®ÁöÑtooltip
                if (festivals.length > 1) {
                    div.title = allFestivalNames;
                }
            }

            return hasTag;
        }



        // ÈÄâÊã©Êó•Êúü
        function selectDate(date) {
            state.selectedDate = date;

            // Êõ¥Êñ∞ÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.calendar-day').forEach(el => {
                el.classList.remove('selected');
            });

            // Â¶ÇÊûúÁÇπÂáªÁöÑÊòØÈùûÂΩìÂâçÊúàÁöÑÊó•ÊúüÔºåÈúÄË¶ÅÂàáÊç¢Âà∞Áõ∏Â∫îÊúà‰ªΩ
            const clickedYear = date.getFullYear();
            const clickedMonth = date.getMonth() + 1;

            if (clickedYear !== state.currentYear || clickedMonth !== state.currentMonth) {
                state.currentYear = clickedYear;
                state.currentMonth = clickedMonth;

                // ÈáçÊñ∞Ê∏≤ÊüìÊó•ÂéÜ
                renderCalendar();

                // Âª∂ËøüÈÄâ‰∏≠Êó•ÊúüÔºåÁ°Æ‰øùÊó•ÂéÜÂ∑≤ÁªèÊ∏≤ÊüìÂÆåÊàê
                setTimeout(() => {
                    document.querySelectorAll('.calendar-day').forEach(el => {
                        if (el.getAttribute('data-date') === date.toDateString()) {
                            el.classList.add('selected');
                        }
                    });
                    // ÊòæÁ§∫ËØ¶ÁªÜ‰ø°ÊÅØ
                    showDetail(date);
                }, 100);
            } else {
                // ÂΩìÂâçÊúàÁöÑÊó•ÊúüÔºåÁõ¥Êé•ÈÄâ‰∏≠
                event.target.classList.add('selected');
                // ÊòæÁ§∫ËØ¶ÁªÜ‰ø°ÊÅØ
                showDetail(date);
            }

            // Â§çÂà∂ËØ¶ÊÉÖÂÜÖÂÆπÂà∞Ââ™Ë¥¥Êùø
            copyDetailToClipboard(date);
        }

        // Â§çÂà∂ÈªÑÂéÜËØ¶ÊÉÖÂà∞Ââ™Ë¥¥Êùø
        function copyDetailToClipboard(date) {
            if (typeof Solar === 'undefined') return;

            try {
                const solar = Solar.fromDate(date);
                const lunar = solar.getLunar ? solar.getLunar() : null;

                if (!lunar) return;

                // Âπ≤ÊîØ‰ø°ÊÅØ
                const yearGanZhi = lunar.getYearInGanZhi();
                const monthGanZhi = lunar.getMonthInGanZhi();
                const dayGanZhi = lunar.getDayInGanZhi();
                const yearShengXiao = lunar.getYearShengXiao();

                // Ëé∑ÂèñÊòüÊúü
                const weekDays = ['ÊòüÊúüÊó•', 'ÊòüÊúü‰∏Ä', 'ÊòüÊúü‰∫å', 'ÊòüÊúü‰∏â', 'ÊòüÊúüÂõõ', 'ÊòüÊúü‰∫î', 'ÊòüÊúüÂÖ≠'];
                const weekDay = weekDays[solar.getWeek()];

                // Ëé∑ÂèñÂÆúÂøå‰ø°ÊÅØ
                const yi = lunar.getDayYi ? lunar.getDayYi() : [];
                const ji = lunar.getDayJi ? lunar.getDayJi() : [];

                // Ëé∑ÂèñÁ∫≥Èü≥‰∫îË°å
                const nayin = lunar.getDayNaYin ? lunar.getDayNaYin() : 'Ëé∑Âèñ‰∏≠';

                // Ëé∑ÂèñÂÜ≤ÁÖû
                const xiongsha = lunar.getDayXiongSha ? lunar.getDayXiongSha() : null;
                const chongsha = (xiongsha && xiongsha.length > 0) ? xiongsha.join(' ') : 'ÂÜ≤ÁÖû‰ø°ÊÅØËé∑Âèñ‰∏≠';

                // Ëé∑ÂèñÂΩ≠Á•ñÁôæÂøå
                const pengzuGan = lunar.getPengZuGan ? lunar.getPengZuGan() : '';
                const pengzuZhi = lunar.getPengZuZhi ? lunar.getPengZuZhi() : '';
                const pengzu = (pengzuGan && pengzuZhi) ? pengzuGan + ' ' + pengzuZhi : 'ÂΩ≠Á•ñÁôæÂøåËé∑Âèñ‰∏≠';

                // Ëé∑ÂèñÁ•ûÁÖû
                const jishen = lunar.getDayJiShen ? lunar.getDayJiShen() : [];
                const xiongshen = lunar.getDayXiongSha ? lunar.getDayXiongSha() : [];

                // Ëé∑ÂèñÊñπ‰Ωç
                const xishenDesc = lunar.getDayPositionXiDesc ? lunar.getDayPositionXiDesc() : '';
                const fushenDesc = lunar.getDayPositionFuDesc ? lunar.getDayPositionFuDesc() : '';
                const caishenDesc = lunar.getDayPositionCaiDesc ? lunar.getDayPositionCaiDesc() : '';

                // Ëé∑ÂèñËäÇÊó•‰ø°ÊÅØÔºàÂåÖÊã¨Èò≥ÂéÜËäÇÊó•„ÄÅÂÜúÂéÜËäÇÊó•„ÄÅÂÖ∂‰ªñËäÇÊó•„ÄÅÊòüÊúüËäÇÊó•ÂíåËäÇÊ∞îÔºâ
                let festivalText = '';
                let allFestivals = [];

                // Èò≥ÂéÜËäÇÊó•
                if (solar.getFestivals) {
                    const solarFestivals = solar.getFestivals();
                    allFestivals = allFestivals.concat(solarFestivals);
                }

                // ÂÜúÂéÜËäÇÊó•
                if (lunar.getFestivals) {
                    const lunarFestivals = lunar.getFestivals();
                    allFestivals = allFestivals.concat(lunarFestivals);
                }

                // ÂÖ∂‰ªñËäÇÊó•ÔºàÂåÖÊã¨Âë®ÊÅ©Êù•ÈÄù‰∏ñÁ∫™ÂøµÊó•„ÄÅ‰∏≠ÂõΩ‰∫∫Ê∞ëË≠¶ÂØüËäÇÁ≠âÔºâ
                if (solar.getOtherFestivals) {
                    const otherFestivals = solar.getOtherFestivals();
                    allFestivals = allFestivals.concat(otherFestivals);
                }

                // ÊòüÊúüËäÇÊó•
                if (typeof SolarUtil !== 'undefined' && SolarUtil.WEEK_FESTIVAL) {
                    const week = solar.getWeek();
                    const weekInMonth = Math.ceil(solar.getDay() / 7);
                    const weekKey1 = solar.getMonth() + '-' + weekInMonth + '-' + week;
                    const weekKey2 = solar.getMonth() + '-0-' + week;

                    const addedFestivals = new Set(allFestivals);

                    if (SolarUtil.WEEK_FESTIVAL[weekKey1]) {
                        const festival = SolarUtil.WEEK_FESTIVAL[weekKey1];
                        if (!addedFestivals.has(festival)) {
                            allFestivals.push(festival);
                            addedFestivals.add(festival);
                        }
                    }
                    if (SolarUtil.WEEK_FESTIVAL[weekKey2]) {
                        const festival = SolarUtil.WEEK_FESTIVAL[weekKey2];
                        if (!addedFestivals.has(festival)) {
                            allFestivals.push(festival);
                            addedFestivals.add(festival);
                        }
                    }
                }

                // Ê∑ªÂä†ËäÇÊó•ÊñáÊú¨
                if (allFestivals.length > 0) {
                    festivalText = '\n„ÄêËäÇÊó•„Äë' + allFestivals.join('„ÄÅ');
                }

                // ËäÇÊ∞î
                const jieqi = lunar.getJieQi ? lunar.getJieQi() : null;
                let jieqiText = '';
                if (jieqi) {
                    jieqiText = '\n„ÄêËäÇÊ∞î„Äë' + jieqi;
                }

                // Ê†ºÂºèÂåñÈò≥ÂéÜÊó•Êúü
                const solarYear = date.getFullYear();
                const solarMonth = date.getMonth() + 1;
                const solarDay = date.getDate();
                const solarDateStr = `${solarYear}Âπ¥${solarMonth}Êúà${solarDay}Êó•`;

                // ÁªÑË£ÖÊñáÊú¨ÂÜÖÂÆπ
                const textToCopy = `„ÄêÊó•Êúü„Äë${solarDateStr} ${weekDay}
„ÄêÂÜúÂéÜ„Äë${lunar.getYearInGanZhi()}${yearShengXiao}Âπ¥ ${lunar.getMonthInChinese()}Êúà${lunar.getDayInChinese()}Êó•
„ÄêÂπ≤ÊîØ„Äë${yearGanZhi}${monthGanZhi}${dayGanZhi}
„Äê‰∫îË°å„Äë${nayin}
„ÄêÂÜ≤ÁÖû„Äë${chongsha}
„ÄêÂΩ≠Á•ñ„Äë${pengzu}
„ÄêÂñúÁ•û„Äë${xishenDesc || 'Êó†'}
„ÄêÁ¶èÁ•û„Äë${fushenDesc || 'Êó†'}
„ÄêË¥¢Á•û„Äë${caishenDesc || 'Êó†'}
„ÄêÂÆú„Äë${yi.join(' ')}
„ÄêÂøå„Äë${ji.join(' ')}
„ÄêÂêâÁ•û„Äë${jishen.join(' ') || 'Êó†'}
„ÄêÂá∂Á•û„Äë${xiongshen.join(' ') || 'Êó†'}${festivalText}${jieqiText}`;

                // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
                navigator.clipboard.writeText(textToCopy).then(() => {
                    showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                }).catch(err => {
                    console.error('Â§çÂà∂Â§±Ë¥•:', err);
                    // ÈôçÁ∫ßÊñπÊ°à
                    const textarea = document.createElement('textarea');
                    textarea.value = textToCopy;
                    document.body.appendChild(textarea);
                    textarea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textarea);
                    showToast('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø');
                });
            } catch (error) {
                console.error('Â§çÂà∂ËØ¶ÊÉÖÊó∂Âá∫Èîô:', error);
            }
        }

        // ÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ


        // Ëé∑ÂèñËäÇÊ∞îËØ¶ÁªÜ‰ø°ÊÅØ
        function getJieqiDetail(date) {
            if (typeof Solar === 'undefined') return null;
            
            try {
                const solar = Solar.fromDate(date);
                const lunar = solar.getLunar ? solar.getLunar() : null;
                
                if (!lunar) return null;
                
                const currentJieqi = lunar.getJieQi ? lunar.getJieQi() : null;
                
                // Ëé∑ÂèñÂΩìÂâçËäÇÊ∞îÁä∂ÊÄÅ
                const isTodayJieqi = currentJieqi !== null && currentJieqi !== '';
                
                // ËÆ°ÁÆóË∑ùÁ¶ª‰∏ã‰∏™ËäÇÊ∞îÁöÑÂ§©Êï∞
                let daysToNextJieqi = null;
                let nextJieqiName = null;
                
                // Êü•Êâæ‰∏ã‰∏™ËäÇÊ∞î
                let checkDate = new Date(date);
                for (let i = 1; i <= 45; i++) { // ÊúÄÂ§öÂæÄÂêéÊü•Êâæ45Â§©
                    checkDate.setDate(checkDate.getDate() + 1);
                    const checkSolar = Solar.fromDate(checkDate);
                    const checkLunar = checkSolar.getLunar ? checkSolar.getLunar() : null;
                    if (checkLunar) {
                        const checkJieqi = checkLunar.getJieQi ? checkLunar.getJieQi() : null;
                        if (checkJieqi) {
                            nextJieqiName = checkJieqi;
                            daysToNextJieqi = i;
                            break;
                        }
                    }
                }
                
                return {
                    currentJieqi: currentJieqi || '',
                    nextJieqi: nextJieqiName,
                    daysToNextJieqi,
                    isTodayJieqi
                };
            } catch (error) {
                console.error('Ëé∑ÂèñËäÇÊ∞îËØ¶ÁªÜ‰ø°ÊÅØÂ§±Ë¥•:', error);
                return null;
            }
        }

        // Ëé∑ÂèñÂç≥Â∞ÜÂà∞Êù•ÁöÑËäÇÊó•È¢ÑÂëä
        function getUpcomingFestivals(date) {
            if (typeof Solar === 'undefined') return [];
            
            const upcomingFestivals = [];
            let checkDate = new Date(date);
            
            // Êü•ÊâæÊú™Êù•365Â§©ÂÜÖÁöÑËäÇÊó•
            for (let i = 1; i <= 365; i++) {
                checkDate.setDate(checkDate.getDate() + 1);
                
                try {
                    const checkSolar = Solar.fromDate(checkDate);
                    const checkLunar = checkSolar.getLunar ? checkSolar.getLunar() : null;
                    
                    if (checkLunar) {
                        let allFestivals = [];
                        
                        // Ê†πÊçÆËÆæÁΩÆËé∑ÂèñÁõ∏Â∫îÁ±ªÂûãÁöÑËäÇÊó•
                        if (state.festivalSettings.showSolarFestivals) {
                            const solarFestivals = checkSolar.getFestivals ? checkSolar.getFestivals() : [];
                            allFestivals = allFestivals.concat(solarFestivals);
                        }
                        
                        if (state.festivalSettings.showLunarFestivals) {
                            const lunarFestivals = checkLunar.getFestivals ? checkLunar.getFestivals() : [];
                            allFestivals = allFestivals.concat(lunarFestivals);
                        }
                        
                        if (state.festivalSettings.showOtherFestivals) {
                            const otherFestivals = checkSolar.getOtherFestivals ? checkSolar.getOtherFestivals() : [];
                            allFestivals = allFestivals.concat(otherFestivals);
                        }
                        
                        // Ëé∑ÂèñÊòüÊúüËäÇÊó•
                        if (state.festivalSettings.showWeekFestivals && typeof SolarUtil !== 'undefined' && SolarUtil.WEEK_FESTIVAL) {
                            const week = checkSolar.getWeek();
                            const weekInMonth = Math.ceil(checkSolar.getDay() / 7);
                            const weekKey1 = checkSolar.getMonth() + '-' + weekInMonth + '-' + week;
                            const weekKey2 = checkSolar.getMonth() + '-0-' + week;
                            
                            // ‰ΩøÁî®SetÊù•ÈÅøÂÖçÈáçÂ§çÊ∑ªÂä†Âêå‰∏Ä‰∏™ËäÇÊó•
                            const addedFestivals = new Set(allFestivals);
                            
                            if (SolarUtil.WEEK_FESTIVAL[weekKey1]) {
                                const festival = SolarUtil.WEEK_FESTIVAL[weekKey1];
                                if (!addedFestivals.has(festival)) {
                                    allFestivals.push(festival);
                                    addedFestivals.add(festival);
                                }
                            }
                            if (SolarUtil.WEEK_FESTIVAL[weekKey2]) {
                                const festival = SolarUtil.WEEK_FESTIVAL[weekKey2];
                                if (!addedFestivals.has(festival)) {
                                    allFestivals.push(festival);
                                    addedFestivals.add(festival);
                                }
                            }
                        }
                        
                        // Ëé∑ÂèñËäÇÊ∞î
                        if (state.festivalSettings.showJieqi) {
                            const jieqi = checkLunar.getJieQi ? checkLunar.getJieQi() : null;
                            if (jieqi) {
                                allFestivals.push(jieqi);
                            }
                        }
                        
                        // Â¶ÇÊûúÊúâËäÇÊó•ÊàñËäÇÊ∞î
                        if (allFestivals.length > 0) {
                            for (const festival of allFestivals) {
                                // ÈÅøÂÖçÈáçÂ§çÊ∑ªÂä†Âêå‰∏ÄÂ§©ÁöÑËäÇÊó•
                                const exists = upcomingFestivals.some(f => 
                                    f.name === festival && f.days === i
                                );
                                if (!exists) {
                                    upcomingFestivals.push({
                                        name: festival,
                                        days: i,
                                        date: new Date(checkDate)
                                    });
                                }
                            }
                        }
                    }
                } catch (error) {
                    console.warn('Ëé∑ÂèñËäÇÊó•‰ø°ÊÅØÂ§±Ë¥•:', error);
                }
                
                // Â¶ÇÊûúÂ∑≤ÁªèÊâæÂà∞Ë∂≥Â§üÁöÑËäÇÊó•Â∞±ÂÅúÊ≠¢ÊêúÁ¥¢
                if (upcomingFestivals.length >= 10) break;
            }
            
            // ÊåâÂ§©Êï∞ÊéíÂ∫èÔºåÂèñÂâç3‰∏™
            return upcomingFestivals
                .sort((a, b) => a.days - b.days)
                .slice(0, 3);
        }

        // Ëé∑ÂèñËäÇÊó•‰ø°ÊÅØ
        function getFestivalInfo(date) {
            if (typeof Solar === 'undefined') return { jieqi: [], holidays: [] };
            
            try {
                const solar = Solar.fromDate(date);
                const lunar = solar.getLunar ? solar.getLunar() : null;
                
                if (!lunar) return { jieqi: [], holidays: [] };
                
                const jieqi = lunar.getJieQi ? lunar.getJieQi() : null;
                const solarFestivals = solar.getFestivals ? solar.getFestivals() : [];
                const lunarFestivals = lunar.getFestivals ? lunar.getFestivals() : [];
                
                // getJieQi() Áõ¥Êé•ËøîÂõûËäÇÊ∞îÂêçÁß∞Â≠óÁ¨¶‰∏≤
                return {
                    jieqi: jieqi ? [jieqi] : [],
                    holidays: [...solarFestivals, ...lunarFestivals]
                };
            } catch (error) {
                return { jieqi: [], holidays: [] };
            }
        }

        // ÊòæÁ§∫ËØ¶ÁªÜ‰ø°ÊÅØ
        function showDetail(date) {
            if (typeof Solar === 'undefined') {
                console.error('lunar.js Êú™Âä†ËΩΩ');
                return;
            }
            
            try {
                const solar = Solar.fromDate(date);
                const lunar = solar.getLunar ? solar.getLunar() : null;
                
                if (!lunar) {
                    console.error('Êó†Ê≥ïËé∑ÂèñÂÜúÂéÜ‰ø°ÊÅØ');
                    return;
                }

            const detailPanel = document.getElementById('detailPanel');
            
            // Âπ≤ÊîØ‰ø°ÊÅØ
            const yearGanZhi = lunar.getYearInGanZhi();
            const monthGanZhi = lunar.getMonthInGanZhi();
            const dayGanZhi = lunar.getDayInGanZhi();
            const yearShengXiao = lunar.getYearShengXiao();

            // Ëé∑ÂèñÊòüÊúü
            const weekDays = ['ÊòüÊúüÊó•', 'ÊòüÊúü‰∏Ä', 'ÊòüÊúü‰∫å', 'ÊòüÊúü‰∏â', 'ÊòüÊúüÂõõ', 'ÊòüÊúü‰∫î', 'ÊòüÊúüÂÖ≠'];
            const weekDay = weekDays[solar.getWeek()];

            // Ëé∑ÂèñÂÆúÂøå‰ø°ÊÅØ
            const yi = lunar.getDayYi();
            const ji = lunar.getDayJi();

            // Ëé∑ÂèñÁ∫≥Èü≥‰∫îË°å
            const nayin = lunar.getDayNaYin ? lunar.getDayNaYin() : 'Ëé∑Âèñ‰∏≠';

            // Ëé∑ÂèñÂÜ≤ÁÖû
            const xiongsha = lunar.getDayXiongSha ? lunar.getDayXiongSha() : [];
            const chongsha = xiongsha.length > 0 ? xiongsha.join(' ') : 'ÂÜ≤ÁÖû‰ø°ÊÅØËé∑Âèñ‰∏≠';

            // Ëé∑ÂèñÂΩ≠Á•ñÁôæÂøå
            const pengzuGan = lunar.getPengZuGan ? lunar.getPengZuGan() : '';
            const pengzuZhi = lunar.getPengZuZhi ? lunar.getPengZuZhi() : '';
            const pengzu = (pengzuGan && pengzuZhi) ? pengzuGan + ' ' + pengzuZhi : 'ÂΩ≠Á•ñÁôæÂøåËé∑Âèñ‰∏≠';

            // Ëé∑ÂèñÁ•ûÁÖû
            const jishen = lunar.getDayJiShen ? lunar.getDayJiShen() : [];
            const xiongshen = lunar.getDayXiongSha ? lunar.getDayXiongSha() : [];

            // Ëé∑ÂèñÊñπ‰Ωç
            const xishen = lunar.getDayPositionXi ? lunar.getDayPositionXi() : null;
            const xishenDesc = xishen && lunar.getDayPositionXiDesc ? lunar.getDayPositionXiDesc() : '';
            const fushen = lunar.getDayPositionFu ? lunar.getDayPositionFu() : null;
            const fushenDesc = fushen && lunar.getDayPositionFuDesc ? lunar.getDayPositionFuDesc() : '';
            const caishen = lunar.getDayPositionCai ? lunar.getDayPositionCai() : null;
            const caishenDesc = caishen && lunar.getDayPositionCaiDesc ? lunar.getDayPositionCaiDesc() : '';



            // Ëé∑ÂèñËäÇÊó•‰ø°ÊÅØ
            const festivalInfo = getFestivalInfo(date);
            
            // Ëé∑ÂèñËäÇÂÅáÊó•‰ø°ÊÅØ
            let holidayInfo = null;
            let holidayHTML = '';
            if (typeof HolidayUtil !== 'undefined') {
                holidayInfo = HolidayUtil.getHoliday(solar.getYear(), solar.getMonth(), solar.getDay());
                if (holidayInfo) {
                    const isWorkDay = holidayInfo.isWork();
                    const statusText = isWorkDay ? 'Ë∞É‰ºë‰∏äÁè≠' : 'Ê≥ïÂÆö‰ºëÊÅØ';
                    const statusIcon = isWorkDay ? 'üè¢' : 'üèñÔ∏è';
                    const statusSymbol = isWorkDay ? 'Áè≠' : '‰ºë';
                    
                    holidayHTML = `
                        <div class="holiday-section">
                            <div class="holiday-title">ÂÖ¨‰ºëÂÆâÊéí</div>
                            <div class="holiday-status ${isWorkDay ? 'work' : 'rest'}">
                                <span class="holiday-symbol">${statusSymbol}</span>
                                <span class="holiday-icon">${statusIcon}</span>
                                <span class="holiday-name">${holidayInfo.getName()}</span>
                                <span class="holiday-type">${statusText}</span>
                            </div>
                        </div>
                    `;
                }
            }
            

            
            // Ëé∑ÂèñÂç≥Â∞ÜÂà∞Êù•ÁöÑËäÇÊó•È¢ÑÂëä
            const upcomingFestivals = getUpcomingFestivals(date);
            let upcomingHTML = '';
            if (upcomingFestivals.length > 0) {
                upcomingHTML = `
                    <div class="upcoming-section">
                        <div class="upcoming-title">È¢ÑÂëä</div>
                        <div class="upcoming-list">
                            ${upcomingFestivals.map(festival => `
                                <div class="upcoming-item">
                                    <div class="upcoming-name">${festival.name}</div>
                                    <div class="upcoming-days">ËøòÊúâ${festival.days}Â§©</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            // Ê†ºÂºèÂåñÈò≥ÂéÜÊó•Êúü
            const solarYear = date.getFullYear();
            const solarMonth = date.getMonth() + 1;
            const solarDay = date.getDate();
            const solarDateStr = `${solarYear}Âπ¥${solarMonth}Êúà${solarDay}Êó•`;
            
            detailPanel.innerHTML = `
                <div class="huangli">
                    <div class="solar-date">${solarDateStr}</div>
                    <div id="md">ÂÜúÂéÜ${lunar.getMonthInChinese()}Êúà${lunar.getDayInChinese()}</div>
                    <div id="ymd">
                        <i>${yearGanZhi}${yearShengXiao}Âπ¥</i>
                        <i>${monthGanZhi}Êúà</i>
                        <i>${dayGanZhi}Êó•</i>
                        <i>${weekDay}</i>
                    </div>
                    <div class="nayin"><b>‰∫îË°å</b><i id="nayin">${nayin}</i></div>
                    <div class="chongsha"><b>ÂÜ≤ÁÖû</b><i id="chongsha">${chongsha}</i></div>
                    <div class="pengzu"><b>ÂΩ≠Á•ñ</b><i id="pengzu">${pengzu}</i></div>
                    <div class="fangwei-container">
                        <div class="fangwei-item">
                            <b>ÂñúÁ•û</b>
                            <i id="xishen">${xishenDesc || 'Ëé∑Âèñ‰∏≠'}</i>
                        </div>
                        <div class="fangwei-item">
                            <b>Á¶èÁ•û</b>
                            <i id="fushen">${fushenDesc || 'Ëé∑Âèñ‰∏≠'}</i>
                        </div>
                        <div class="fangwei-item">
                            <b>Ë¥¢Á•û</b>
                            <i id="caishen">${caishenDesc || 'Ëé∑Âèñ‰∏≠'}</i>
                        </div>
                    </div>
                    <div class="yishen-container">
                        <div class="yiji" id="yi">
                            <b>ÂÆú</b>
                            <div class="yiji-content">
                                ${yi.map(item => `<i>${item}</i>`).join('')}
                            </div>
                        </div>
                        <div class="yiji ji" id="ji">
                            <b>Âøå</b>
                            <div class="yiji-content">
                                ${ji.map(item => `<i>${item}</i>`).join('')}
                            </div>
                        </div>
                        <div class="shen" id="jshen">
                            <b>ÂêâÁ•û</b>
                            <div class="shen-content">
                                ${jishen.map(item => `<i>${item}</i>`).join('')}
                            </div>
                        </div>
                        <div class="shen" id="xshen">
                            <b>Âá∂Á•û</b>
                            <div class="shen-content">
                                ${xiongshen.map(item => `<i>${item}</i>`).join('')}
                            </div>
                        </div>
                    </div>
                    ${holidayHTML}
                    ${upcomingHTML}
                </div>
            `;

            // Ê∑ªÂä†Âä®ÁîªÊïàÊûú
            detailPanel.style.animation = 'none';
            setTimeout(() => {
                detailPanel.style.animation = 'slideIn 0.3s ease-out';
            }, 10);
            } catch (error) {
                console.error('ÊòæÁ§∫ÈªÑÂéÜ‰ø°ÊÅØÊó∂Âá∫Èîô:', error);
                detailPanel.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÈªÑÂéÜ‰ø°ÊÅØÂ§±Ë¥•</p></div>';
            }
        }

        // ÂàáÊç¢Êúà‰ªΩ
        function changeMonth(direction) {
            state.currentMonth += direction;
            
            if (state.currentMonth > 12) {
                state.currentMonth = 1;
                state.currentYear++;
            } else if (state.currentMonth < 1) {
                state.currentMonth = 12;
                state.currentYear--;
            }
            
            renderCalendar();
        }

        // Ë∑≥ËΩ¨Âà∞‰ªäÂ§©
        function goToToday() {
            const today = new Date();
            state.currentYear = today.getFullYear();
            state.currentMonth = today.getMonth() + 1;
            
            renderCalendar();
            // Âª∂ËøüÈÄâ‰∏≠‰ªäÂ§©ÔºåÁ°Æ‰øùÊó•ÂéÜÂ∑≤ÁªèÊ∏≤ÊüìÂÆåÊàê
            setTimeout(() => {
                showToday();
            }, 100);
        }

        // Ê∑ªÂä†CSSÂä®Áîª
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
        `;
        document.head.appendChild(style);

        // ÂàùÂßãÂåñÂë®Ëµ∑ÂßãÊó•ËÆæÁΩÆ
        function initializeWeekStartSettings() {
            // ‰ªélocalStorageÂä†ËΩΩËÆæÁΩÆ
            const savedWeekStart = localStorage.getItem('weekStart');
            if (savedWeekStart) {
                try {
                    state.weekStart = parseInt(savedWeekStart);
                    updateWeekStartUI();
                } catch (error) {
                    console.warn('Âä†ËΩΩÂë®Ëµ∑ÂßãÊó•ËÆæÁΩÆÂ§±Ë¥•:', error);
                }
            } else {
                // ÈªòËÆ§Âë®‰∏Ä‰∏∫ÊøÄÊ¥ªÁä∂ÊÄÅ
                state.weekStart = 1;
                updateWeekStartUI();
            }
        }

        // ÂàáÊç¢Âë®Ëµ∑ÂßãÊó•
        function toggleWeekStart(value) {
            state.weekStart = value;
            
            // ‰øùÂ≠òËÆæÁΩÆÂà∞localStorage
            localStorage.setItem('weekStart', state.weekStart.toString());
            
            // Êõ¥Êñ∞UI
            updateWeekStartUI();
            
            // ÈáçÊñ∞Ê∏≤ÊüìÊó•ÂéÜ
            renderCalendar();
        }

        // Êõ¥Êñ∞Âë®Ëµ∑ÂßãÊó•UIÁä∂ÊÄÅ
        function updateWeekStartUI() {
            const options = document.querySelectorAll('.weekstart-option');
            options.forEach(option => {
                const value = parseInt(option.getAttribute('data-value'));
                if (value === state.weekStart) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });
        }

        // ÂàùÂßãÂåñËäÇÊó•ËÆæÁΩÆ
        function initializeFestivalSettings() {
            // ‰ªélocalStorageÂä†ËΩΩËÆæÁΩÆ
            const savedSettings = localStorage.getItem('festivalSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    Object.assign(state.festivalSettings, settings);
                    
                    // Êõ¥Êñ∞checkboxÁä∂ÊÄÅ
                    Object.keys(settings).forEach(key => {
                        const checkbox = document.getElementById(key);
                        if (checkbox) {
                            checkbox.checked = settings[key];
                        }
                    });
                } catch (error) {
                    console.warn('Âä†ËΩΩËäÇÊó•ËÆæÁΩÆÂ§±Ë¥•:', error);
                }
            }
        }

        // ÂàáÊç¢ËäÇÊó•ÈÄâÊã©Âô®ÊòæÁ§∫
        function toggleFestivalSelector() {
            const dropdown = document.getElementById('festivalDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
                
                // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
                document.addEventListener('click', closeFestivalSelector);
            }
        }

        // ÂÖ≥Èó≠ËäÇÊó•ÈÄâÊã©Âô®
        function closeFestivalSelector(event) {
            const dropdown = document.getElementById('festivalDropdown');
            const toggle = document.querySelector('.festival-toggle');
            
            if (dropdown && !dropdown.contains(event.target) && event.target !== toggle) {
                dropdown.classList.remove('show');
                document.removeEventListener('click', closeFestivalSelector);
            }
        }

        // Êõ¥Êñ∞ËäÇÊó•ËÆæÁΩÆ
        function updateFestivalSettings() {
            const checkboxes = ['showSolarFestivals', 'showLunarFestivals', 'showJieqi', 'showWeekFestivals', 'showOtherFestivals'];

            checkboxes.forEach(id => {
                const checkbox = document.getElementById(id);
                if (checkbox) {
                    state.festivalSettings[id] = checkbox.checked;
                }
            });

            // ‰øùÂ≠òËÆæÁΩÆÂà∞localStorage
            localStorage.setItem('festivalSettings', JSON.stringify(state.festivalSettings));

            // ÈáçÊñ∞Ê∏≤ÊüìÊó•ÂéÜ
            renderCalendar();
        }



        // ÊµãËØïÂáΩÊï∞ÔºöÊòæÁ§∫ÂΩìÂâçÊúà‰ªΩÊâÄÊúâÂåÖÂê´‰∏â‰πù‰ø°ÊÅØÁöÑÊó•Êúü
        function showFuJiuDates() {
            if (typeof Solar === 'undefined') {
                alert('lunar.js Êú™Âä†ËΩΩÂÆåÊàê');
                return;
            }
            
            const daysInMonth = SolarUtil.getDaysOfMonth(state.currentYear, state.currentMonth);
            let fuJiuDates = [];
            
            for (let day = 1; day <= daysInMonth; day++) {
                try {
                    const solar = Solar.fromYmd(state.currentYear, state.currentMonth, day);
                    const lunar = solar.getLunar();
                    
                    // Ê£ÄÊü•‰∏â‰ºè
                    if (lunar.getFu) {
                        const fu = lunar.getFu();
                        if (fu) {
                            fuJiuDates.push(`${state.currentYear}Âπ¥${state.currentMonth}Êúà${day}Êó• - ${fu}`);
                        }
                    }
                    
                    // Ê£ÄÊü•‰∏â‰πùÔºà‰ΩøÁî®Êñ∞ÁöÑgetShuJiuÊñπÊ≥ïÔºâ
                    if (lunar.getShuJiu) {
                        const shuJiu = lunar.getShuJiu();
                        if (shuJiu) {
                            fuJiuDates.push(`${state.currentYear}Âπ¥${state.currentMonth}Êúà${day}Êó• - ${shuJiu.getName()}Á¨¨${shuJiu.getIndex()}Â§©`);
                        }
                    }
                    
                    // ÂÖºÂÆπÊóßÁöÑ‰∏â‰πùÊñπÊ≥ï
                    if (lunar.getJiu) {
                        const jiu = lunar.getJiu();
                        if (jiu) {
                            fuJiuDates.push(`${state.currentYear}Âπ¥${state.currentMonth}Êúà${day}Êó• - ${jiu}`);
                        }
                    }
                } catch (error) {
                    console.warn(`Ëé∑Âèñ${state.currentYear}Âπ¥${state.currentMonth}Êúà${day}Êó•‰ø°ÊÅØÂ§±Ë¥•:`, error);
                }
            }
            
            if (fuJiuDates.length > 0) {
                alert('ÂΩìÂâçÊúà‰ªΩÂåÖÂê´‰∏â‰πù‰ø°ÊÅØÁöÑÊó•ÊúüÔºö\n\n' + fuJiuDates.join('\n'));
            } else {
                // Êô∫ËÉΩÊèêÁ§∫ÔºöÊ†πÊçÆÂΩìÂâçÊúà‰ªΩÁªôÂá∫Âª∫ËÆÆ
                let suggestion = '';
                if (state.currentMonth >= 3 && state.currentMonth <= 8) {
                    suggestion = '\n\nÊèêÁ§∫Ôºö‰∏â‰πù‰ø°ÊÅØÈÄöÂ∏∏Âú®ÂÜ¨Â≠£Ôºà12Êúà-2ÊúàÔºâÂá∫Áé∞„ÄÇ\nÂª∫ËÆÆÂàáÊç¢Âà∞ÂÜ¨Â≠£Êúà‰ªΩÊü•Áúã‰∏â‰πù‰ø°ÊÅØ„ÄÇ';
                } else if (state.currentMonth >= 6 && state.currentMonth <= 8) {
                    suggestion = '\n\nÊèêÁ§∫ÔºöÂΩìÂâçÊòØÂ§èÂ≠£Ôºå‰∏â‰ºè‰ø°ÊÅØÈÄöÂ∏∏Âú®Â§èÂ≠£Âá∫Áé∞„ÄÇ\nÂª∫ËÆÆÊü•Áúã‰∏â‰ºè‰ø°ÊÅØÊàñÂàáÊç¢Âà∞ÂÜ¨Â≠£Êü•Áúã‰∏â‰πù‰ø°ÊÅØ„ÄÇ';
                } else {
                    suggestion = '\n\nÊèêÁ§∫Ôºö‰∏â‰πù‰ø°ÊÅØÈÄöÂ∏∏Âú®ÂÜ¨Ëá≥ÂêéÂºÄÂßãÂá∫Áé∞„ÄÇ\nÂª∫ËÆÆÊ£ÄÊü•ÂΩìÂâçÂπ¥‰ªΩÁöÑÂÜ¨Ëá≥Êó•ÊúüÊòØÂê¶Ê≠£Á°Æ„ÄÇ';
                }
                
                // Ê£ÄÊü•ÂÜ¨Ëá≥ÊòØÂê¶Âú®ÂΩìÂâçÊúà‰ªΩ
                try {
                    const dongzhi = Lunar.fromYmd(state.currentYear, 12, 1).getJieQiTable()['ÂÜ¨Ëá≥'];
                    if (dongzhi) {
                        // Â∞ùËØï‰∏çÂêåÁöÑËé∑ÂèñÊñπÂºè
                        let dongzhiDate, dongzhiMonth;
                        if (typeof dongzhi.getSolar === 'function') {
                            dongzhiDate = dongzhi.getSolar();
                            dongzhiMonth = dongzhiDate.getMonth();
                        } else if (dongzhi.getMonth) {
                            dongzhiMonth = dongzhi.getMonth();
                            dongzhiDate = dongzhi;
                        } else {
                            // Â¶ÇÊûúÊó†Ê≥ïËé∑ÂèñÊúà‰ªΩ‰ø°ÊÅØÔºåÁõ¥Êé•ÊòæÁ§∫Êó•Êúü
                            dongzhiDate = dongzhi.toString ? dongzhi.toString() : dongzhi;
                            suggestion += `\n\nÂÜ¨Ëá≥Êó•ÊúüÔºö${dongzhiDate}ÔºåÊï∞‰πù‰ªéËøô‰∏ÄÂ§©ÂºÄÂßã„ÄÇ`;
                            return;
                        }
                        
                        if (dongzhiMonth + 1 === state.currentMonth) {
                            suggestion += `\n\nÂÜ¨Ëá≥Êó•ÊúüÔºö${dongzhiDate.toString()}ÔºåÊï∞‰πù‰ªéËøô‰∏ÄÂ§©ÂºÄÂßã„ÄÇ`;
                        }
                    }
                } catch (error) {
                    console.warn('Ëé∑ÂèñÂÜ¨Ëá≥‰ø°ÊÅØÂ§±Ë¥•:', error);
                }
                
                alert('ÂΩìÂâçÊúà‰ªΩÊ≤°Êúâ‰∏â‰πù‰ø°ÊÅØ' + suggestion);
            }
        }

        // ÂàáÊç¢‰∏ªÈ¢òÈÄâÊã©Âô®ÊòæÁ§∫
        function toggleThemeSelector() {
            const dropdown = document.getElementById('themeDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
                
                // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
                document.addEventListener('click', closeThemeSelector);
            }
        }

        // ÂÖ≥Èó≠‰∏ªÈ¢òÈÄâÊã©Âô®
        function closeThemeSelector(event) {
            const dropdown = document.getElementById('themeDropdown');
            const toggle = document.querySelector('.theme-toggle');
            
            if (dropdown && !dropdown.contains(event.target) && event.target !== toggle) {
                dropdown.classList.remove('show');
                document.removeEventListener('click', closeThemeSelector);
            }
        }

        // ËÆæÁΩÆ‰∏ªÈ¢ò
        function setTheme(theme) {
            // ÁßªÈô§ÊâÄÊúâ‰∏ªÈ¢òÁ±ª
            document.body.classList.remove('light-theme', 'dark-theme');
            
            if (theme === 'dark') {
                document.body.classList.add('dark-theme');
            } else if (theme === 'light') {
                // ÊµÖËâ≤‰∏ªÈ¢ò‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÁ±ªÂêç
            } else if (theme === 'system') {
                // Ê£ÄÊµãÁ≥ªÁªü‰∏ªÈ¢òÂÅèÂ•Ω
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.body.classList.add('dark-theme');
                }
            }
            
            // ‰øùÂ≠ò‰∏ªÈ¢òËÆæÁΩÆÂà∞localStorage
            localStorage.setItem('theme', theme);
            
            // Êõ¥Êñ∞UIÁä∂ÊÄÅ
            updateThemeUI(theme);
            
            // ÂÖ≥Èó≠‰∏ãÊãâËèúÂçï
            const dropdown = document.getElementById('themeDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
        }

        // Êõ¥Êñ∞‰∏ªÈ¢òUIÁä∂ÊÄÅ
        function updateThemeUI(activeTheme) {
            const options = document.querySelectorAll('.theme-option');
            options.forEach(option => {
                const theme = option.getAttribute('data-theme');
                if (theme === activeTheme) {
                    option.classList.add('active');
                } else {
                    option.classList.remove('active');
                }
            });
        }

        // ÂàùÂßãÂåñ‰∏ªÈ¢òËÆæÁΩÆ
        function initializeThemeSettings() {
            // ‰ªélocalStorageÂä†ËΩΩËÆæÁΩÆÔºåÈªòËÆ§‰ΩøÁî®"Ë∑üÈöèÁ≥ªÁªü"
            const savedTheme = localStorage.getItem('theme');
            const theme = savedTheme || 'system';
            setTheme(theme);
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>